<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MonadComprehensions #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings   #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.PlutusCore.TypeSynthesis</span><span> </span><span class="hs-special">(</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typecheckProgram"><span class="hs-identifier hs-var">typecheckProgram</span></a><span>
</span><a name="line-6"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typecheckTerm"><span class="hs-identifier hs-var">typecheckTerm</span></a><span>
</span><a name="line-7"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheck"><span class="hs-identifier hs-var">kindCheck</span></a><span>
</span><a name="line-8"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runTypeCheckM"><span class="hs-identifier hs-var">runTypeCheckM</span></a><span>
</span><a name="line-9"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runInTypeCheckM"><span class="hs-identifier hs-var">runInTypeCheckM</span></a><span>
</span><a name="line-10"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dynamicBuiltinNameMeaningsToTypes"><span class="hs-identifier hs-var">dynamicBuiltinNameMeaningsToTypes</span></a><span>
</span><a name="line-11"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier hs-type">DynamicBuiltinNameTypes</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span>
</span><a name="line-13"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Error.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span>                                         </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Constant.html"><span class="hs-identifier">Language.PlutusCore.Constant</span></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Error.html"><span class="hs-identifier">Language.PlutusCore.Error</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Lexer.Type.html"><span class="hs-identifier">Language.PlutusCore.Lexer.Type</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Lexer.Type.html#name"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Name.html"><span class="hs-identifier">Language.PlutusCore.Name</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Normalize.html"><span class="hs-identifier">Language.PlutusCore.Normalize</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Quote.html"><span class="hs-identifier">Language.PlutusCore.Quote</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Renamer.html"><span class="hs-identifier">Language.PlutusCore.Renamer</span></a><span>    </span><span class="hs-special">(</span><a href="Language.PlutusCore.Renamer.html#annotateType"><span class="hs-identifier hs-var">annotateType</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Renamer.html#rename"><span class="hs-identifier hs-var">rename</span></a><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Type.html"><span class="hs-identifier">Language.PlutusCore.Type</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><a href="PlutusPrelude.html"><span class="hs-identifier">PlutusPrelude</span></a><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Error.Lens</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Reader</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Map</span><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>                       </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-comment">{- Note [Costs]
Typechecking costs are relatively simple: it costs 1 gas to perform
a reduction. Substitution does not in general cost anything.

Costs are reset every time we enter 'NormalizeTypeT'.

In unlimited mode, gas is not tracked and we do not fail even on large numbers
of reductions.
-}</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">-- | Mapping from 'DynamicBuiltinName's to their 'Type's.</span><span>
</span><a name="line-44"></a><span class="hs-keyword">newtype</span><span> </span><a name="DynamicBuiltinNameTypes"><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier">DynamicBuiltinNameTypes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DynamicBuiltinNameTypes"><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier">DynamicBuiltinNameTypes</span></a></a><span>
</span><a name="line-45"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="unDynamicBuiltinNameTypes"><a href="Language.PlutusCore.TypeSynthesis.html#unDynamicBuiltinNameTypes"><span class="hs-identifier">unDynamicBuiltinNameTypes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#DynamicBuiltinName"><span class="hs-identifier hs-type">DynamicBuiltinName</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Semigroup</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | Configuration of the type checker.</span><span>
</span><a name="line-49"></a><span class="hs-keyword">data</span><span> </span><a name="TypeConfig"><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier">TypeConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TypeConfig"><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier">TypeConfig</span></a></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="_typeConfigNormalize"><a href="Language.PlutusCore.TypeSynthesis.html#_typeConfigNormalize"><span class="hs-identifier">_typeConfigNormalize</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-51"></a><span>      </span><span class="hs-comment">-- ^ Whether to normalize type annotations.</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_typeConfigDynBuiltinNameTypes"><a href="Language.PlutusCore.TypeSynthesis.html#_typeConfigDynBuiltinNameTypes"><span class="hs-identifier">_typeConfigDynBuiltinNameTypes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier hs-type">DynamicBuiltinNameTypes</span></a><span>
</span><a name="line-53"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_typeConfigGas"><a href="Language.PlutusCore.TypeSynthesis.html#_typeConfigGas"><span class="hs-identifier">_typeConfigGas</span></a></a><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.PlutusCore.Type.html#Gas"><span class="hs-identifier hs-type">Gas</span></a><span>
</span><a name="line-54"></a><span>       </span><span class="hs-comment">-- ^ The upper limit on the length of type reductions.</span><span>
</span><a name="line-55"></a><span>       </span><span class="hs-comment">-- If set to 'Nothing', type reductions will be unbounded.</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-comment">-- | The type checking monad contains the 'BuiltinTable' and it lets us throw 'TypeError's.</span><span>
</span><a name="line-59"></a><span class="hs-keyword">type</span><span> </span><a name="TypeCheckM"><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier">TypeCheckM</span></a></a><span> </span><a name="local-6989586621679572003"><a href="#local-6989586621679572003"><span class="hs-identifier">ann</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">ReaderT</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ExceptT</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a><span> </span><a href="#local-6989586621679572003"><span class="hs-identifier hs-type">ann</span></a><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- | Run a 'NormalizeTypeT' computation in the 'TypeCheckM' context.</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- Depending on whether gas is finite or infinite, calls either</span><span>
</span><a name="line-63"></a><span class="hs-comment">-- 'runNormalizeTypeDownM' or 'runNormalizeTypeGasM'.</span><span>
</span><a name="line-64"></a><span class="hs-comment">-- Throws 'OutOfGas' if type normalization runs out of gas.</span><span>
</span><a name="line-65"></a><span class="hs-identifier">runInTypeCheckM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679572034"><a href="#local-6989586621679572034"><span class="hs-identifier">m</span></a></a><span class="hs-operator">.</span><span> </span><a href="Language.PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a><span> </span><a href="#local-6989586621679572034"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.Normalize.html#NormalizeTypeT"><span class="hs-identifier hs-type">NormalizeTypeT</span></a><span> </span><a href="#local-6989586621679572034"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679572030"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679572031"><span class="hs-identifier hs-type">ann1</span></a><span> </span><a href="#local-6989586621679572032"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572033"><span class="hs-identifier hs-type">ann2</span></a><span> </span><a href="#local-6989586621679572032"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-66"></a><a name="runInTypeCheckM"><a href="Language.PlutusCore.TypeSynthesis.html#runInTypeCheckM"><span class="hs-identifier">runInTypeCheckM</span></a></a><span> </span><a name="local-6989586621679572035"><a href="#local-6989586621679572035"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-67"></a><span>    </span><a name="local-6989586621679572036"><a href="#local-6989586621679572036"><span class="hs-identifier">mayGas</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-identifier">_typeConfigGas</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679572036"><span class="hs-identifier hs-var">mayGas</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-69"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Normalize.html#runNormalizeTypeDownM"><span class="hs-identifier hs-var">runNormalizeTypeDownM</span></a><span> </span><a href="#local-6989586621679572035"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-70"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679572037"><a href="#local-6989586621679572037"><span class="hs-identifier">gas</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-71"></a><span>            </span><a name="local-6989586621679572038"><a href="#local-6989586621679572038"><span class="hs-identifier">mayX</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Normalize.html#runNormalizeTypeGasM"><span class="hs-identifier hs-var">runNormalizeTypeGasM</span></a><span> </span><a href="#local-6989586621679572037"><span class="hs-identifier hs-var">gas</span></a><span> </span><a href="#local-6989586621679572035"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-72"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679572038"><span class="hs-identifier hs-var">mayX</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-73"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwing</span><span> </span><a href="Language.PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a><span> </span><a href="Language.PlutusCore.Error.html#OutOfGas"><span class="hs-identifier hs-var">OutOfGas</span></a><span>
</span><a name="line-74"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679572039"><a href="#local-6989586621679572039"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679572039"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-comment">-- | Normalize a 'Type'.</span><span>
</span><a name="line-77"></a><span class="hs-identifier">normalizeTypeTcm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572029"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><a name="normalizeTypeTcm"><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeTcm"><span class="hs-identifier">normalizeTypeTcm</span></a></a><span> </span><a name="local-6989586621679572040"><a href="#local-6989586621679572040"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runInTypeCheckM"><span class="hs-identifier hs-var">runInTypeCheckM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Normalize.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a><span> </span><a href="#local-6989586621679572040"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">-- | Substitute a type for a variable in a type and normalize the result.</span><span>
</span><a name="line-81"></a><span class="hs-identifier">substituteNormalizeTypeTcm</span><span>
</span><a name="line-82"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- ^ @ty@</span><span>
</span><a name="line-83"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                                </span><span class="hs-comment">-- ^ @name@</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                           </span><span class="hs-comment">-- ^ @body@</span><span>
</span><a name="line-85"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572028"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><a name="substituteNormalizeTypeTcm"><a href="Language.PlutusCore.TypeSynthesis.html#substituteNormalizeTypeTcm"><span class="hs-identifier">substituteNormalizeTypeTcm</span></a></a><span> </span><a name="local-6989586621679572041"><a href="#local-6989586621679572041"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679572042"><a href="#local-6989586621679572042"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679572043"><a href="#local-6989586621679572043"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runInTypeCheckM"><span class="hs-identifier hs-var">runInTypeCheckM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Normalize.html#substituteNormalizeTypeM"><span class="hs-identifier hs-var">substituteNormalizeTypeM</span></a><span> </span><a href="#local-6989586621679572041"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679572042"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679572043"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">-- | Normalize a 'Type' or simply wrap it in the 'NormalizedType' constructor</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- if we are working with normalized type annotations.</span><span>
</span><a name="line-90"></a><span class="hs-identifier">normalizeTypeOptTcm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572027"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><a name="normalizeTypeOptTcm"><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier">normalizeTypeOptTcm</span></a></a><span> </span><a name="local-6989586621679572044"><a href="#local-6989586621679572044"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-92"></a><span>    </span><a name="local-6989586621679572045"><a href="#local-6989586621679572045"><span class="hs-identifier">normalize</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-identifier">_typeConfigNormalize</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679572045"><span class="hs-identifier hs-var">normalize</span></a><span>
</span><a name="line-94"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeTcm"><span class="hs-identifier hs-var">normalizeTypeTcm</span></a><span> </span><a href="#local-6989586621679572044"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-95"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><a href="#local-6989586621679572044"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-identifier">sizeToType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><a name="sizeToType"><a href="Language.PlutusCore.TypeSynthesis.html#sizeToType"><span class="hs-identifier">sizeToType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Size"><span class="hs-identifier hs-var">Size</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-comment">-- | Get the 'Kind' of a 'TypeBuiltin'.</span><span>
</span><a name="line-101"></a><span class="hs-identifier">kindOfTypeBuiltin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TypeBuiltin"><span class="hs-identifier hs-type">TypeBuiltin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-102"></a><a name="kindOfTypeBuiltin"><a href="Language.PlutusCore.TypeSynthesis.html#kindOfTypeBuiltin"><span class="hs-identifier">kindOfTypeBuiltin</span></a></a><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyInteger"><span class="hs-identifier hs-var">TyInteger</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#sizeToType"><span class="hs-identifier hs-var">sizeToType</span></a><span>
</span><a name="line-103"></a><span class="hs-identifier">kindOfTypeBuiltin</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyByteString"><span class="hs-identifier hs-var">TyByteString</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#sizeToType"><span class="hs-identifier hs-var">sizeToType</span></a><span>
</span><a name="line-104"></a><span class="hs-identifier">kindOfTypeBuiltin</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TySize"><span class="hs-identifier hs-var">TySize</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#sizeToType"><span class="hs-identifier hs-var">sizeToType</span></a><span>
</span><a name="line-105"></a><span class="hs-identifier">kindOfTypeBuiltin</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyString"><span class="hs-identifier hs-var">TyString</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-comment">-- | Annotate a 'Type'. Invariant: the type must be in normal form. The invariant is not checked.</span><span>
</span><a name="line-108"></a><span class="hs-comment">-- In case a type is open, an 'OpenTypeOfBuiltin' is returned.</span><span>
</span><a name="line-109"></a><span class="hs-comment">-- We use this for annotating types of built-ins (both static and dynamic).</span><span>
</span><a name="line-110"></a><span class="hs-identifier">annotateNormalizeType</span><span>
</span><a name="line-111"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679572026"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572026"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><a name="annotateNormalizeType"><a href="Language.PlutusCore.TypeSynthesis.html#annotateNormalizeType"><span class="hs-identifier">annotateNormalizeType</span></a></a><span> </span><a name="local-6989586621679572046"><a href="#local-6989586621679572046"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679572047"><a href="#local-6989586621679572047"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679572048"><a href="#local-6989586621679572048"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Language.PlutusCore.Renamer.html#annotateType"><span class="hs-identifier hs-var">annotateType</span></a><span> </span><a href="#local-6989586621679572048"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-identifier hs-var">Left</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">::</span><a href="Language.PlutusCore.Error.html#RenameError"><span class="hs-identifier hs-type">RenameError</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwing</span><span> </span><a href="Language.PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Error.html#InternalTypeErrorE"><span class="hs-identifier hs-var">InternalTypeErrorE</span></a><span> </span><a href="#local-6989586621679572046"><span class="hs-identifier hs-var">ann</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Error.html#OpenTypeOfBuiltin"><span class="hs-identifier hs-var">OpenTypeOfBuiltin</span></a><span> </span><a href="#local-6989586621679572048"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679572047"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-114"></a><span>    </span><span class="hs-comment">-- That's quite inefficient, but is there anything we can do about that?</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679572049"><a href="#local-6989586621679572049"><span class="hs-identifier">annTyOfName</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeTcm"><span class="hs-identifier hs-var">normalizeTypeTcm</span></a><span> </span><a href="#local-6989586621679572049"><span class="hs-identifier hs-var">annTyOfName</span></a><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-comment">-- | Annotate the type of a 'BuiltinName' and return it wrapped in 'NormalizedType'.</span><span>
</span><a name="line-118"></a><span class="hs-identifier">normalizedAnnotatedTypeOfBuiltinName</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679572025"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#BuiltinName"><span class="hs-identifier hs-type">BuiltinName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572025"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><a name="normalizedAnnotatedTypeOfBuiltinName"><a href="Language.PlutusCore.TypeSynthesis.html#normalizedAnnotatedTypeOfBuiltinName"><span class="hs-identifier">normalizedAnnotatedTypeOfBuiltinName</span></a></a><span> </span><a name="local-6989586621679572050"><a href="#local-6989586621679572050"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679572051"><a href="#local-6989586621679572051"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-121"></a><span>    </span><a name="local-6989586621679572052"><a href="#local-6989586621679572052"><span class="hs-identifier">tyOfName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Constant.Function.html#typeOfBuiltinName"><span class="hs-identifier hs-var">typeOfBuiltinName</span></a><span> </span><a href="#local-6989586621679572051"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-122"></a><span>    </span><span class="hs-comment">-- Types of built-in names are already normalized.</span><span>
</span><a name="line-123"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#annotateNormalizeType"><span class="hs-identifier hs-var">annotateNormalizeType</span></a><span> </span><a href="#local-6989586621679572050"><span class="hs-identifier hs-var">ann</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinName"><span class="hs-identifier hs-var">BuiltinName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572051"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572052"><span class="hs-identifier hs-var">tyOfName</span></a><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-comment">-- | Extract the 'TypeScheme' from a 'DynamicBuiltinNameMeaning' and convert it to the</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- corresponding @Type TyName@ for each row of a 'DynamicBuiltinNameMeanings'.</span><span>
</span><a name="line-127"></a><span class="hs-identifier">dynamicBuiltinNameMeaningsToTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Constant.Typed.html#DynamicBuiltinNameMeanings"><span class="hs-identifier hs-type">DynamicBuiltinNameMeanings</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier hs-type">DynamicBuiltinNameTypes</span></a><span>
</span><a name="line-128"></a><a name="dynamicBuiltinNameMeaningsToTypes"><a href="Language.PlutusCore.TypeSynthesis.html#dynamicBuiltinNameMeaningsToTypes"><span class="hs-identifier">dynamicBuiltinNameMeaningsToTypes</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Constant.Typed.html#DynamicBuiltinNameMeanings"><span class="hs-identifier hs-var">DynamicBuiltinNameMeanings</span></a><span> </span><a name="local-6989586621679572053"><a href="#local-6989586621679572053"><span class="hs-identifier">means</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-129"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier hs-var">DynamicBuiltinNameTypes</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Language.PlutusCore.Constant.Function.html#dynamicBuiltinNameMeaningToType"><span class="hs-identifier hs-var">dynamicBuiltinNameMeaningToType</span></a><span> </span><a href="#local-6989586621679572053"><span class="hs-identifier hs-var">means</span></a><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-comment">-- | Type-check a program, returning a normalized type.</span><span>
</span><a name="line-132"></a><span class="hs-identifier">typecheckProgram</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a><span> </span><a href="#local-6989586621679572022"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679572023"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadError</span><span> </span><a href="#local-6989586621679572022"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679572024"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a><span> </span><a href="#local-6989586621679572024"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span>
</span><a name="line-134"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><a href="Language.PlutusCore.Type.html#NameWithType"><span class="hs-identifier hs-type">NameWithType</span></a><span> </span><a href="#local-6989586621679572023"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-135"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679572024"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-136"></a><a name="typecheckProgram"><a href="Language.PlutusCore.TypeSynthesis.html#typecheckProgram"><span class="hs-identifier">typecheckProgram</span></a></a><span> </span><a name="local-6989586621679572054"><a href="#local-6989586621679572054"><span class="hs-identifier">cfg</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Program"><span class="hs-identifier hs-var">Program</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572055"><a href="#local-6989586621679572055"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typecheckTerm"><span class="hs-identifier hs-var">typecheckTerm</span></a><span> </span><a href="#local-6989586621679572054"><span class="hs-identifier hs-var">cfg</span></a><span> </span><a href="#local-6989586621679572055"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- | Type-check a term, returning a normalized type.</span><span>
</span><a name="line-139"></a><span class="hs-identifier">typecheckTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a><span> </span><a href="#local-6989586621679572019"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679572020"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadError</span><span> </span><a href="#local-6989586621679572019"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679572021"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a><span> </span><a href="#local-6989586621679572021"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span>
</span><a name="line-141"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><a href="Language.PlutusCore.Type.html#NameWithType"><span class="hs-identifier hs-type">NameWithType</span></a><span> </span><a href="#local-6989586621679572020"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-142"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679572021"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-143"></a><a name="typecheckTerm"><a href="Language.PlutusCore.TypeSynthesis.html#typecheckTerm"><span class="hs-identifier">typecheckTerm</span></a></a><span> </span><a name="local-6989586621679572056"><a href="#local-6989586621679572056"><span class="hs-identifier">cfg</span></a></a><span> </span><a name="local-6989586621679572057"><a href="#local-6989586621679572057"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Error.html#throwingEither"><span class="hs-identifier hs-var">throwingEither</span></a><span> </span><a href="Language.PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">runExceptT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runTypeCheckM"><span class="hs-identifier hs-var">runTypeCheckM</span></a><span> </span><a href="#local-6989586621679572056"><span class="hs-identifier hs-var">cfg</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679572057"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-comment">-- | Kind-check a PLC type.</span><span>
</span><a name="line-146"></a><span class="hs-identifier">kindCheck</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a><span> </span><a href="#local-6989586621679572016"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679572017"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadError</span><span> </span><a href="#local-6989586621679572016"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679572018"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a><span> </span><a href="#local-6989586621679572018"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span>
</span><a name="line-148"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><a href="#local-6989586621679572017"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-149"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679572018"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><a name="kindCheck"><a href="Language.PlutusCore.TypeSynthesis.html#kindCheck"><span class="hs-identifier">kindCheck</span></a></a><span> </span><a name="local-6989586621679572058"><a href="#local-6989586621679572058"><span class="hs-identifier">cfg</span></a></a><span> </span><a name="local-6989586621679572059"><a href="#local-6989586621679572059"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Error.html#throwingEither"><span class="hs-identifier hs-var">throwingEither</span></a><span> </span><a href="Language.PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">runExceptT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runTypeCheckM"><span class="hs-identifier hs-var">runTypeCheckM</span></a><span> </span><a href="#local-6989586621679572058"><span class="hs-identifier hs-var">cfg</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679572059"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-comment">-- | Run the type checker with a default context.</span><span>
</span><a name="line-153"></a><span class="hs-identifier">runTypeCheckM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span>
</span><a name="line-154"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572014"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679572015"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-155"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExceptT</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a><span> </span><a href="#local-6989586621679572014"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a><span> </span><a href="#local-6989586621679572015"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-156"></a><a name="runTypeCheckM"><a href="Language.PlutusCore.TypeSynthesis.html#runTypeCheckM"><span class="hs-identifier">runTypeCheckM</span></a></a><span> </span><a name="local-6989586621679572060"><a href="#local-6989586621679572060"><span class="hs-identifier">typeConfig</span></a></a><span> </span><a name="local-6989586621679572061"><a href="#local-6989586621679572061"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-157"></a><span>    </span><span class="hs-identifier">runReaderT</span><span> </span><a href="#local-6989586621679572061"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679572060"><span class="hs-identifier hs-var">typeConfig</span></a><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">-- | Extract kind information from a type.</span><span>
</span><a name="line-160"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><a href="#local-6989586621679572013"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572013"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-161"></a><a name="kindOf"><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier">kindOf</span></a></a><span> </span><a href="Language.PlutusCore.Type.html#TyInt"><span class="hs-identifier hs-var">TyInt</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Size"><span class="hs-identifier hs-var">Size</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a><span> </span><a name="local-6989586621679572062"><a href="#local-6989586621679572062"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679572063"><a href="#local-6989586621679572063"><span class="hs-identifier">dom</span></a></a><span> </span><a name="local-6989586621679572064"><a href="#local-6989586621679572064"><span class="hs-identifier">cod</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-163"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679572062"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572063"><span class="hs-identifier hs-var">dom</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679572062"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572064"><span class="hs-identifier hs-var">cod</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a><span> </span><a name="local-6989586621679572065"><a href="#local-6989586621679572065"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572066"><a href="#local-6989586621679572066"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-167"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679572065"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572066"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyLam"><span class="hs-identifier hs-var">TyLam</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572067"><a href="#local-6989586621679572067"><span class="hs-identifier">argK</span></a></a><span> </span><a name="local-6989586621679572068"><a href="#local-6989586621679572068"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572067"><span class="hs-identifier hs-var">argK</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679572068"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-170"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-var">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-var">TyName</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Name.html#Name"><span class="hs-identifier hs-var">Name</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679572069"><a href="#local-6989586621679572069"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572069"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyBuiltin"><span class="hs-identifier hs-var">TyBuiltin</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572070"><a href="#local-6989586621679572070"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOfTypeBuiltin"><span class="hs-identifier hs-var">kindOfTypeBuiltin</span></a><span> </span><a href="#local-6989586621679572070"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">-- [infer| arg :: k]    [check| pat :: (k -&gt; *) -&gt; k -&gt; *]</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- -------------------------------------------------------</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- [infer| ifix pat arg :: *]</span><span>
</span><a name="line-176"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a><span> </span><a name="local-6989586621679572071"><a href="#local-6989586621679572071"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679572072"><a href="#local-6989586621679572072"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679572073"><a href="#local-6989586621679572073"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-177"></a><span>    </span><a name="local-6989586621679572074"><a href="#local-6989586621679572074"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679572073"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-178"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckPatternFunctorM"><span class="hs-identifier hs-var">kindCheckPatternFunctorM</span></a><span> </span><a href="#local-6989586621679572071"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572072"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679572074"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-179"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- [infer| fun :: dom -&gt; cod]    [check | arg :: dom]</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- --------------------------------------------------</span><span>
</span><a name="line-183"></a><span class="hs-comment">-- [infer| fun arg :: cod]</span><span>
</span><a name="line-184"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a><span> </span><a name="local-6989586621679572075"><a href="#local-6989586621679572075"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679572076"><a href="#local-6989586621679572076"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679572077"><a href="#local-6989586621679572077"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-185"></a><span>    </span><a name="local-6989586621679572078"><a href="#local-6989586621679572078"><span class="hs-identifier">funKind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679572076"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-186"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679572078"><span class="hs-identifier hs-var">funKind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-187"></a><span>        </span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572079"><a href="#local-6989586621679572079"><span class="hs-identifier">dom</span></a></a><span> </span><a name="local-6989586621679572080"><a href="#local-6989586621679572080"><span class="hs-identifier">cod</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-188"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679572075"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572077"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679572079"><span class="hs-identifier hs-var">dom</span></a><span>
</span><a name="line-189"></a><span>            </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679572080"><span class="hs-identifier hs-var">cod</span></a><span>
</span><a name="line-190"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Error.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a href="#local-6989586621679572075"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572076"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyKind"><span class="hs-identifier hs-var">dummyKind</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyKind"><span class="hs-identifier hs-var">dummyKind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572078"><span class="hs-identifier hs-var">funKind</span></a><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- | Check that the kind of a pattern functor is @(k -&gt; *) -&gt; k -&gt; *@.</span><span>
</span><a name="line-193"></a><span class="hs-identifier">kindCheckPatternFunctorM</span><span>
</span><a name="line-194"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679572012"><span class="hs-identifier hs-type">ann</span></a><span>
</span><a name="line-195"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><a href="#local-6989586621679572012"><span class="hs-identifier hs-type">ann</span></a><span>  </span><span class="hs-comment">-- ^ A pattern functor.</span><span>
</span><a name="line-196"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                  </span><span class="hs-comment">-- ^ @k@.</span><span>
</span><a name="line-197"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572012"><span class="hs-identifier hs-type">ann</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-198"></a><a name="kindCheckPatternFunctorM"><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckPatternFunctorM"><span class="hs-identifier">kindCheckPatternFunctorM</span></a></a><span> </span><a name="local-6989586621679572081"><a href="#local-6989586621679572081"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679572082"><a href="#local-6989586621679572082"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679572083"><a href="#local-6989586621679572083"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-199"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679572081"><span class="hs-identifier hs-var">ann</span></a><span> </span><a href="#local-6989586621679572082"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572083"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572083"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-comment">-- | Check a 'Type' against a 'Kind'.</span><span>
</span><a name="line-202"></a><span class="hs-identifier">kindCheckM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679572011"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><a href="#local-6989586621679572011"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572011"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-203"></a><a name="kindCheckM"><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier">kindCheckM</span></a></a><span> </span><a name="local-6989586621679572084"><a href="#local-6989586621679572084"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679572085"><a href="#local-6989586621679572085"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679572086"><a href="#local-6989586621679572086"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-204"></a><span>    </span><a name="local-6989586621679572087"><a href="#local-6989586621679572087"><span class="hs-identifier">tyK</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679572085"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-205"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679572087"><span class="hs-identifier hs-var">tyK</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679572086"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a href="#local-6989586621679572084"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572085"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572086"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679572087"><span class="hs-identifier hs-var">tyK</span></a><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-comment">-- | Apply a 'TypeBuiltin' to a 'Size' and wrap in 'NormalizedType'.</span><span>
</span><a name="line-208"></a><span class="hs-identifier">applySizedNormalized</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TypeBuiltin"><span class="hs-identifier hs-type">TypeBuiltin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="#local-6989586621679572010"><span class="hs-identifier hs-type">tyname</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-209"></a><a name="applySizedNormalized"><a href="Language.PlutusCore.TypeSynthesis.html#applySizedNormalized"><span class="hs-identifier">applySizedNormalized</span></a></a><span> </span><a name="local-6989586621679572088"><a href="#local-6989586621679572088"><span class="hs-identifier">tb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.PlutusCore.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyBuiltin"><span class="hs-identifier hs-var">TyBuiltin</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572088"><span class="hs-identifier hs-var">tb</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.PlutusCore.Type.html#TyInt"><span class="hs-identifier hs-var">TyInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-identifier">dummyUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Name.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-212"></a><a name="dummyUnique"><a href="Language.PlutusCore.TypeSynthesis.html#dummyUnique"><span class="hs-identifier">dummyUnique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Name.html#Unique"><span class="hs-identifier hs-var">Unique</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span class="hs-identifier">dummyTyName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-215"></a><a name="dummyTyName"><a href="Language.PlutusCore.TypeSynthesis.html#dummyTyName"><span class="hs-identifier">dummyTyName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-var">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-var">TyName</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Name.html#Name"><span class="hs-identifier hs-var">Name</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;*&quot;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyUnique"><span class="hs-identifier hs-var">dummyUnique</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-identifier">dummyKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-218"></a><a name="dummyKind"><a href="Language.PlutusCore.TypeSynthesis.html#dummyKind"><span class="hs-identifier">dummyKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span class="hs-identifier">dummyType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-221"></a><a name="dummyType"><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier">dummyType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyTyName"><span class="hs-identifier hs-var">dummyTyName</span></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-comment">-- | Look up a 'DynamicBuiltinName' in the 'DynBuiltinNameTypes' environment.</span><span>
</span><a name="line-224"></a><span class="hs-identifier">lookupDynamicBuiltinName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679572009"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#DynamicBuiltinName"><span class="hs-identifier hs-type">DynamicBuiltinName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572009"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-225"></a><a name="lookupDynamicBuiltinName"><a href="Language.PlutusCore.TypeSynthesis.html#lookupDynamicBuiltinName"><span class="hs-identifier">lookupDynamicBuiltinName</span></a></a><span> </span><a name="local-6989586621679572089"><a href="#local-6989586621679572089"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679572090"><a href="#local-6989586621679572090"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-226"></a><span>    </span><a name="local-6989586621679572091"><a href="#local-6989586621679572091"><span class="hs-identifier">dbnts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">unDynamicBuiltinNameTypes</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">_typeConfigDynBuiltinNameTypes</span><span>
</span><a name="line-227"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679572090"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679572091"><span class="hs-identifier hs-var">dbnts</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-228"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-229"></a><span>            </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Error.html#UnknownDynamicBuiltinName"><span class="hs-identifier hs-var">UnknownDynamicBuiltinName</span></a><span> </span><a href="#local-6989586621679572089"><span class="hs-identifier hs-var">ann</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#UnknownDynamicBuiltinNameErrorE"><span class="hs-identifier hs-var">UnknownDynamicBuiltinNameErrorE</span></a><span> </span><a href="#local-6989586621679572090"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679572092"><a href="#local-6989586621679572092"><span class="hs-identifier">quoTy</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-231"></a><span>            </span><a name="local-6989586621679572093"><a href="#local-6989586621679572093"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a><span> </span><a href="#local-6989586621679572092"><span class="hs-identifier hs-var">quoTy</span></a><span>
</span><a name="line-232"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#annotateNormalizeType"><span class="hs-identifier hs-var">annotateNormalizeType</span></a><span> </span><a href="#local-6989586621679572089"><span class="hs-identifier hs-var">ann</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#DynBuiltinName"><span class="hs-identifier hs-var">DynBuiltinName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572090"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572093"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">-- | Get the 'Type' of a 'Constant' wrapped in 'NormalizedType'.</span><span>
</span><a name="line-235"></a><span class="hs-identifier">typeOfConstant</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a><span> </span><a href="#local-6989586621679572008"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-236"></a><a name="typeOfConstant"><a href="Language.PlutusCore.TypeSynthesis.html#typeOfConstant"><span class="hs-identifier">typeOfConstant</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinInt"><span class="hs-identifier hs-var">BuiltinInt</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572094"><a href="#local-6989586621679572094"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#applySizedNormalized"><span class="hs-identifier hs-var">applySizedNormalized</span></a><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyInteger"><span class="hs-identifier hs-var">TyInteger</span></a><span>    </span><a href="#local-6989586621679572094"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-237"></a><span class="hs-identifier">typeOfConstant</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinBS"><span class="hs-identifier hs-var">BuiltinBS</span></a><span>   </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572095"><a href="#local-6989586621679572095"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#applySizedNormalized"><span class="hs-identifier hs-var">applySizedNormalized</span></a><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyByteString"><span class="hs-identifier hs-var">TyByteString</span></a><span> </span><a href="#local-6989586621679572095"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-238"></a><span class="hs-identifier">typeOfConstant</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinSize"><span class="hs-identifier hs-var">BuiltinSize</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572096"><a href="#local-6989586621679572096"><span class="hs-identifier">size</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#applySizedNormalized"><span class="hs-identifier hs-var">applySizedNormalized</span></a><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TySize"><span class="hs-identifier hs-var">TySize</span></a><span>       </span><a href="#local-6989586621679572096"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-239"></a><span class="hs-identifier">typeOfConstant</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinStr"><span class="hs-identifier hs-var">BuiltinStr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#TyBuiltin"><span class="hs-identifier hs-var">TyBuiltin</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyString"><span class="hs-identifier hs-var">TyString</span></a><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-identifier">typeOfBuiltin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a><span> </span><a href="#local-6989586621679572007"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572007"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-242"></a><a name="typeOfBuiltin"><a href="Language.PlutusCore.TypeSynthesis.html#typeOfBuiltin"><span class="hs-identifier">typeOfBuiltin</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinName"><span class="hs-identifier hs-var">BuiltinName</span></a><span>    </span><a name="local-6989586621679572097"><a href="#local-6989586621679572097"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679572098"><a href="#local-6989586621679572098"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizedAnnotatedTypeOfBuiltinName"><span class="hs-identifier hs-var">normalizedAnnotatedTypeOfBuiltinName</span></a><span> </span><a href="#local-6989586621679572097"><span class="hs-identifier hs-var">ann</span></a><span> </span><a href="#local-6989586621679572098"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-243"></a><span class="hs-identifier">typeOfBuiltin</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#DynBuiltinName"><span class="hs-identifier hs-var">DynBuiltinName</span></a><span> </span><a name="local-6989586621679572099"><a href="#local-6989586621679572099"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679572100"><a href="#local-6989586621679572100"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#lookupDynamicBuiltinName"><span class="hs-identifier hs-var">lookupDynamicBuiltinName</span></a><span> </span><a href="#local-6989586621679572099"><span class="hs-identifier hs-var">ann</span></a><span> </span><a href="#local-6989586621679572100"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-comment">{- Note [Type rules]
We write type rules in the bidirectional style.
[infer| x : a] -- means that the inferred type of 'x' is 'a'. 'a' is not necessary a varible, e.g.
[infer| fun : dom -&gt; cod] is fine too. It reads as follows: &quot;infer the type of 'fun', check that its
functional and bind the 'dom' variable to the domain and the 'cod' variable to the codomain of this type&quot;.

Analogously, [infer| t :: k] means that the inferred kind of 't' is 'k'.
The [infer| x : a] judgement appears in conclusions in the clauses of the 'typeOf' function.
[check| x : a] -- check that the type of 'x' is 'a'. Since Plutus Core is fully elaborated language,
this amounts to inferring the type of 'x' and checking that it's equal to 'a'.
The equality check is denoted as &quot;a ~ b&quot;.

Analogously, [check| t :: k] means &quot;check that the kind of 't' is 'k'&quot;.
The [check| x : a] judgement appears in the conclusion in the sole clause of the 'typeCheckM' function.
The &quot;NORM a&quot; notation reads as &quot;normalize 'a'&quot;.
The &quot;a ~&gt;? b&quot; notations reads as &quot;optionally normalize 'a' to 'b'&quot;. The &quot;optionally&quot; part is due to the
fact that we allow non-normalized types during development, but do not allow to submit them on a chain.
-}</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-comment">-- See the [Type rules] and [Type environments] notes.</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- | Synthesize the type of a term, returning a normalized type.</span><span>
</span><a name="line-266"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><a href="Language.PlutusCore.Type.html#NameWithType"><span class="hs-identifier hs-type">NameWithType</span></a><span> </span><a href="#local-6989586621679572006"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572006"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-comment">-- v : ty    ty ~&gt;? vTy</span><span>
</span><a name="line-269"></a><span class="hs-comment">-- --------------------</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- [infer| var v : vTy]</span><span>
</span><a name="line-271"></a><a name="typeOf"><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier">typeOf</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NameWithType"><span class="hs-identifier hs-var">NameWithType</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Name.html#Name"><span class="hs-identifier hs-var">Name</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679572101"><a href="#local-6989586621679572101"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-272"></a><span>    </span><span class="hs-comment">-- Since we kind check types at lambdas, we can normalize types here without kind checking.</span><span>
</span><a name="line-273"></a><span>    </span><span class="hs-comment">-- Type normalization at each variable is inefficient and we may consider something else later.</span><span>
</span><a name="line-274"></a><span>    </span><span class="hs-comment">-- We 'rename' the type of a variable here before normalizing it. Otherwise we would get duplicate</span><span>
</span><a name="line-275"></a><span>    </span><span class="hs-comment">-- names, because the annotation machinery takes the type at a lambda and duplicates it for each</span><span>
</span><a name="line-276"></a><span>    </span><span class="hs-comment">-- usage of the variable the lambda binds.</span><span>
</span><a name="line-277"></a><span>    </span><a href="Language.PlutusCore.Renamer.html#rename"><span class="hs-identifier hs-var">rename</span></a><span> </span><a href="#local-6989586621679572101"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">void</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-comment">-- [check| dom :: *]    dom ~&gt;? vDom    [infer| body : vCod]</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- ---------------------------------------------------------</span><span>
</span><a name="line-281"></a><span class="hs-comment">-- [infer| lam n dom body : vDom -&gt; vCod]</span><span>
</span><a name="line-282"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#LamAbs"><span class="hs-identifier hs-var">LamAbs</span></a><span> </span><a name="local-6989586621679572102"><a href="#local-6989586621679572102"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572103"><a href="#local-6989586621679572103"><span class="hs-identifier">dom</span></a></a><span> </span><a name="local-6989586621679572104"><a href="#local-6989586621679572104"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-283"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679572102"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572103"><span class="hs-identifier hs-var">dom</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>    </span><a href="Language.PlutusCore.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572103"><span class="hs-identifier hs-var">dom</span></a><span class="hs-special">)</span><span> </span><a href="PlutusPrelude.html#%3C%3C%2A%3E%3E"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679572104"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-comment">-- [check| ty :: *]    ty ~&gt;? vTy</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- ------------------------------</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- [infer| error ty : vTy]</span><span>
</span><a name="line-289"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Error"><span class="hs-identifier hs-var">Error</span></a><span> </span><a name="local-6989586621679572105"><a href="#local-6989586621679572105"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679572106"><a href="#local-6989586621679572106"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-290"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679572105"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572106"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572106"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">-- [infer| body : vBodyTy]</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- ----------------------------------------------</span><span>
</span><a name="line-295"></a><span class="hs-comment">-- [infer| abs n nK body : all (n :: nK) vBodyTy]</span><span>
</span><a name="line-296"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyAbs"><span class="hs-identifier hs-var">TyAbs</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572107"><a href="#local-6989586621679572107"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679572108"><a href="#local-6989586621679572108"><span class="hs-identifier">nK</span></a></a><span> </span><a name="local-6989586621679572109"><a href="#local-6989586621679572109"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>                       </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572107"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572108"><span class="hs-identifier hs-var">nK</span></a><span class="hs-special">)</span><span> </span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679572109"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-comment">-- c : vTy</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- --------------------</span><span>
</span><a name="line-300"></a><span class="hs-comment">-- [infer| con c : vTy]</span><span>
</span><a name="line-301"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Constant"><span class="hs-identifier hs-var">Constant</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572110"><a href="#local-6989586621679572110"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.TypeSynthesis.html#typeOfConstant"><span class="hs-identifier hs-var">typeOfConstant</span></a><span> </span><a href="#local-6989586621679572110"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-comment">-- bi : vTy</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- -------------------------</span><span>
</span><a name="line-305"></a><span class="hs-comment">-- [infer| builtin by : vTy]</span><span>
</span><a name="line-306"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Builtin"><span class="hs-identifier hs-var">Builtin</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572111"><a href="#local-6989586621679572111"><span class="hs-identifier">bi</span></a></a><span class="hs-special">)</span><span>                            </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOfBuiltin"><span class="hs-identifier hs-var">typeOfBuiltin</span></a><span> </span><a href="#local-6989586621679572111"><span class="hs-identifier hs-var">bi</span></a><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span class="hs-comment">-- [infer| fun : vDom -&gt; vCod]    [check| arg : vDom]</span><span>
</span><a name="line-309"></a><span class="hs-comment">-- --------------------------------------------------</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- [infer| fun arg : vCod]</span><span>
</span><a name="line-311"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a><span> </span><a name="local-6989586621679572112"><a href="#local-6989586621679572112"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679572113"><a href="#local-6989586621679572113"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679572114"><a href="#local-6989586621679572114"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-312"></a><span>    </span><a name="local-6989586621679572115"><a href="#local-6989586621679572115"><span class="hs-identifier">vFunTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679572113"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-313"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679572115"><span class="hs-identifier hs-var">vFunTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-314"></a><span>        </span><a href="Language.PlutusCore.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572116"><a href="#local-6989586621679572116"><span class="hs-identifier">vDom</span></a></a><span> </span><a name="local-6989586621679572117"><a href="#local-6989586621679572117"><span class="hs-identifier">vCod</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-315"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#typeCheckM"><span class="hs-identifier hs-var">typeCheckM</span></a><span> </span><a href="#local-6989586621679572112"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572114"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><a href="#local-6989586621679572116"><span class="hs-identifier hs-var">vDom</span></a><span>  </span><span class="hs-comment">-- Subpart of a normalized type, so normalized.</span><span>
</span><a name="line-316"></a><span>            </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><a href="#local-6989586621679572117"><span class="hs-identifier hs-var">vCod</span></a><span>              </span><span class="hs-comment">-- Subpart of a normalized type, so normalized.</span><span>
</span><a name="line-317"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a><span> </span><a href="#local-6989586621679572112"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572113"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572115"><span class="hs-identifier hs-var">vFunTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-comment">-- [infer| body : all (n :: nK) vCod]    [check| ty :: tyK]    ty ~&gt;? vTy</span><span>
</span><a name="line-320"></a><span class="hs-comment">-- ----------------------------------------------------------------------</span><span>
</span><a name="line-321"></a><span class="hs-comment">-- [infer| body {ty} : NORM ([vTy / n] vCod)]</span><span>
</span><a name="line-322"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyInst"><span class="hs-identifier hs-var">TyInst</span></a><span> </span><a name="local-6989586621679572118"><a href="#local-6989586621679572118"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679572119"><a href="#local-6989586621679572119"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621679572120"><a href="#local-6989586621679572120"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-323"></a><span>    </span><a name="local-6989586621679572121"><a href="#local-6989586621679572121"><span class="hs-identifier">vBodyTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679572119"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-324"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679572121"><span class="hs-identifier hs-var">vBodyTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-325"></a><span>        </span><a href="Language.PlutusCore.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572122"><a href="#local-6989586621679572122"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679572123"><a href="#local-6989586621679572123"><span class="hs-identifier">nK</span></a></a><span> </span><a name="local-6989586621679572124"><a href="#local-6989586621679572124"><span class="hs-identifier">vCod</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-326"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679572118"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572120"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679572123"><span class="hs-identifier hs-var">nK</span></a><span>
</span><a name="line-327"></a><span>            </span><a name="local-6989586621679572125"><a href="#local-6989586621679572125"><span class="hs-identifier">vTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572120"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-328"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#substituteNormalizeTypeTcm"><span class="hs-identifier hs-var">substituteNormalizeTypeTcm</span></a><span> </span><a href="#local-6989586621679572125"><span class="hs-identifier hs-var">vTy</span></a><span> </span><a href="#local-6989586621679572122"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679572124"><span class="hs-identifier hs-var">vCod</span></a><span>
</span><a name="line-329"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a><span> </span><a href="#local-6989586621679572118"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572119"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyTyName"><span class="hs-identifier hs-var">dummyTyName</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyKind"><span class="hs-identifier hs-var">dummyKind</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572121"><span class="hs-identifier hs-var">vBodyTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span class="hs-comment">-- [infer| term : ifix vPat vArg]    [infer| vArg :: k]</span><span>
</span><a name="line-332"></a><span class="hs-comment">-- ------------------------------------------------------------------</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- [infer| unwrap term : NORM (vPat (\(a :: k) -&gt; ifix vPat a) vArg)]</span><span>
</span><a name="line-334"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Unwrap"><span class="hs-identifier hs-var">Unwrap</span></a><span> </span><a name="local-6989586621679572126"><a href="#local-6989586621679572126"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679572127"><a href="#local-6989586621679572127"><span class="hs-identifier">term</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-335"></a><span>    </span><a name="local-6989586621679572128"><a href="#local-6989586621679572128"><span class="hs-identifier">vTermTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679572127"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-336"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679572128"><span class="hs-identifier hs-var">vTermTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-337"></a><span>        </span><a href="Language.PlutusCore.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679572129"><a href="#local-6989586621679572129"><span class="hs-identifier">vPat</span></a></a><span> </span><a name="local-6989586621679572130"><a href="#local-6989586621679572130"><span class="hs-identifier">vArg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-338"></a><span>            </span><a name="local-6989586621679572131"><a href="#local-6989586621679572131"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679572126"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;$</span><span> </span><a href="#local-6989586621679572130"><span class="hs-identifier hs-var">vArg</span></a><span>
</span><a name="line-339"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#unfoldFixOf"><span class="hs-identifier hs-var">unfoldFixOf</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><a href="#local-6989586621679572129"><span class="hs-identifier hs-var">vPat</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><a href="#local-6989586621679572130"><span class="hs-identifier hs-var">vArg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572131"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-340"></a><span>        </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a><span> </span><a href="#local-6989586621679572126"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572127"><span class="hs-identifier hs-var">term</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572128"><span class="hs-identifier hs-var">vTermTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-comment">-- [infer| arg :: k]    [check| pat :: (k -&gt; *) -&gt; k -&gt; *]    pat ~&gt;? vPat    arg ~&gt;? vArg</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- [check| term : NORM (vPat (\(a :: k) -&gt; ifix vPat a) vArg)]</span><span>
</span><a name="line-344"></a><span class="hs-comment">-- ---------------------------------------------------------------------------------------</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- [infer| iwrap pat arg term : ifix vPat vArg]</span><span>
</span><a name="line-346"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#IWrap"><span class="hs-identifier hs-var">IWrap</span></a><span> </span><a name="local-6989586621679572132"><a href="#local-6989586621679572132"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679572133"><a href="#local-6989586621679572133"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679572134"><a href="#local-6989586621679572134"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679572135"><a href="#local-6989586621679572135"><span class="hs-identifier">term</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-347"></a><span>    </span><a name="local-6989586621679572136"><a href="#local-6989586621679572136"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679572134"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-348"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckPatternFunctorM"><span class="hs-identifier hs-var">kindCheckPatternFunctorM</span></a><span> </span><a href="#local-6989586621679572132"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572133"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679572136"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-349"></a><span>    </span><a name="local-6989586621679572137"><a href="#local-6989586621679572137"><span class="hs-identifier">vPat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572133"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-350"></a><span>    </span><a name="local-6989586621679572138"><a href="#local-6989586621679572138"><span class="hs-identifier">vArg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572134"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-351"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#typeCheckM"><span class="hs-identifier hs-var">typeCheckM</span></a><span> </span><a href="#local-6989586621679572132"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679572135"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#unfoldFixOf"><span class="hs-identifier hs-var">unfoldFixOf</span></a><span> </span><a href="#local-6989586621679572137"><span class="hs-identifier hs-var">vPat</span></a><span> </span><a href="#local-6989586621679572138"><span class="hs-identifier hs-var">vArg</span></a><span> </span><a href="#local-6989586621679572136"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-352"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679572137"><span class="hs-identifier hs-var">vPat</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679572138"><span class="hs-identifier hs-var">vArg</span></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- | Check a 'Term' against a 'NormalizedType'.</span><span>
</span><a name="line-355"></a><span class="hs-identifier">typeCheckM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679572005"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-356"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><a href="Language.PlutusCore.Type.html#NameWithType"><span class="hs-identifier hs-type">NameWithType</span></a><span> </span><a href="#local-6989586621679572005"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-357"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-358"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572005"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>
</span><a name="line-360"></a><span class="hs-comment">-- [infer| term : vTermTy]    vTermTy ~ vTy</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- ----------------------------------------</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- [check| term : vTy]</span><span>
</span><a name="line-363"></a><a name="typeCheckM"><a href="Language.PlutusCore.TypeSynthesis.html#typeCheckM"><span class="hs-identifier">typeCheckM</span></a></a><span> </span><a name="local-6989586621679572139"><a href="#local-6989586621679572139"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679572140"><a href="#local-6989586621679572140"><span class="hs-identifier">term</span></a></a><span> </span><a name="local-6989586621679572141"><a href="#local-6989586621679572141"><span class="hs-identifier">vTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-364"></a><span>    </span><a name="local-6989586621679572142"><a href="#local-6989586621679572142"><span class="hs-identifier">vTermTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679572140"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-365"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679572142"><span class="hs-identifier hs-var">vTermTy</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679572141"><span class="hs-identifier hs-var">vTy</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a><span> </span><a href="#local-6989586621679572139"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679572140"><span class="hs-identifier hs-var">term</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679572142"><span class="hs-identifier hs-var">vTermTy</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572141"><span class="hs-identifier hs-var">vTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span class="hs-comment">-- | @unfoldFixOf pat arg k = NORM (vPat (\(a :: k) -&gt; ifix vPat a) arg)@</span><span>
</span><a name="line-368"></a><span class="hs-identifier">unfoldFixOf</span><span>
</span><a name="line-369"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ @vPat@</span><span>
</span><a name="line-370"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ @vArg@</span><span>
</span><a name="line-371"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                           </span><span class="hs-comment">-- ^ @k@</span><span>
</span><a name="line-372"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679572004"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-type">TyNameWithKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-373"></a><a name="unfoldFixOf"><a href="Language.PlutusCore.TypeSynthesis.html#unfoldFixOf"><span class="hs-identifier">unfoldFixOf</span></a></a><span> </span><a name="local-6989586621679572143"><a href="#local-6989586621679572143"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679572144"><a href="#local-6989586621679572144"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679572145"><a href="#local-6989586621679572145"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-374"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679572146"><a href="#local-6989586621679572146"><span class="hs-identifier">vPat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679572143"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-375"></a><span>        </span><a name="local-6989586621679572147"><a href="#local-6989586621679572147"><span class="hs-identifier">vArg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679572144"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-376"></a><span>    </span><a name="local-6989586621679572148"><a href="#local-6989586621679572148"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#TyNameWithKind"><span class="hs-identifier hs-var">TyNameWithKind</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusCore.Quote.html#freshTyName"><span class="hs-identifier hs-var">freshTyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679572145"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;a&quot;</span><span>
</span><a name="line-377"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeTcm"><span class="hs-identifier hs-var">normalizeTypeTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-378"></a><span>        </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572146"><span class="hs-identifier hs-var">vPat</span></a><span>
</span><a name="line-379"></a><span>            </span><span class="hs-special">[</span><span> </span><a href="Language.PlutusCore.Type.html#TyLam"><span class="hs-identifier hs-var">TyLam</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572148"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679572145"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.PlutusCore.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572146"><span class="hs-identifier hs-var">vPat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679572148"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-380"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679572147"><span class="hs-identifier hs-var">vArg</span></a><span>
</span><a name="line-381"></a><span>            </span><span class="hs-special">]</span><span>
</span><a name="line-382"></a></pre></body></html>