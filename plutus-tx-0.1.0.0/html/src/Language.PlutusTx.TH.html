<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds        #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell  #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><a name="line-4"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.PlutusTx.TH</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-5"></a><span>    </span><a href="Language.PlutusTx.TH.html#compile"><span class="hs-identifier hs-var">compile</span></a><span class="hs-special">,</span><span>
</span><a name="line-6"></a><span>    </span><a href="Language.PlutusTx.TH.html#compileUntyped"><span class="hs-identifier hs-var">compileUntyped</span></a><span class="hs-special">,</span><span>
</span><a name="line-7"></a><span>    </span><span class="hs-identifier hs-type">CompiledCode</span><span class="hs-special">,</span><span>
</span><a name="line-8"></a><span>    </span><span class="hs-identifier hs-var">getSerializedPlc</span><span class="hs-special">,</span><span>
</span><a name="line-9"></a><span>    </span><span class="hs-identifier hs-var">getSerializedPir</span><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>    </span><span class="hs-identifier hs-var">getPlc</span><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>    </span><span class="hs-identifier hs-var">getPir</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusTx.Plugin</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.Haskell.TH</span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TH</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Syntax</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TH</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-comment">-- | Compile a quoted Haskell expression into a corresponding Plutus Core program.</span><span>
</span><a name="line-19"></a><span class="hs-identifier">compile</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TH.Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TH.TExp</span><span> </span><a href="#local-6989586621679109508"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TH.Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TH.TExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CompiledCode</span><span> </span><a href="#local-6989586621679109508"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- See note [Typed TH]</span><span>
</span><a name="line-21"></a><a name="compile"><a href="Language.PlutusTx.TH.html#compile"><span class="hs-identifier">compile</span></a></a><span> </span><a name="local-6989586621679109509"><a href="#local-6989586621679109509"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TH.unsafeTExpCoerce</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.TH.html#compileUntyped"><span class="hs-identifier hs-var">compileUntyped</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">TH.unType</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679109509"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-comment">{- Note [Typed TH]
It's nice to use typed TH! However, we sadly can't *quite* use it thoroughly, because we
want to make a type literal, and there's no way to do that properly with typed TH.

Moreover, we really want to create an expression with the precise form that we want,
so we can't isolate the badness much. So we pretty much just have to use unsafeTExpCoerce
and assert that we know what we're doing.

This isn't so bad, since our plc function accepts an argument of any type, so that's always
going to typecheck, and the result is always a CompiledCode, so that's also fine.
-}</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-comment">-- | Compile a quoted Haskell expression into a corresponding Plutus Core program.</span><span>
</span><a name="line-36"></a><span class="hs-identifier">compileUntyped</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TH.Q</span><span> </span><span class="hs-identifier hs-type">TH.Exp</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TH.Q</span><span> </span><span class="hs-identifier hs-type">TH.Exp</span><span>
</span><a name="line-37"></a><a name="compileUntyped"><a href="Language.PlutusTx.TH.html#compileUntyped"><span class="hs-identifier">compileUntyped</span></a></a><span> </span><a name="local-6989586621679109524"><a href="#local-6989586621679109524"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-identifier hs-var">TH.addCorePlugin</span><span> </span><span class="hs-string">&quot;Language.PlutusTx.Plugin&quot;</span><span>
</span><a name="line-39"></a><span>    </span><a name="local-6989586621679109525"><a href="#local-6989586621679109525"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">TH.location</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679109526"><a href="#local-6989586621679109526"><span class="hs-identifier">locStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TH.pprint</span><span> </span><a href="#local-6989586621679109525"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-41"></a><span>    </span><span class="hs-comment">-- See note [Typed TH]</span><span>
</span><a name="line-42"></a><span>    </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier hs-var">plc</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">$(</span><span class="hs-identifier hs-var">TH.litT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">TH.strTyLit</span><span> </span><a href="#local-6989586621679109526"><span class="hs-identifier hs-var">locStr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">$(</span><a href="#local-6989586621679109524"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><a name="line-43"></a></pre></body></html>