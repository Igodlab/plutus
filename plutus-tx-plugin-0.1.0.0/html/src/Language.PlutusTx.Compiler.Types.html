<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds   #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts  #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE Rank2Types        #-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.PlutusTx.Compiler.Types</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.Error.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Error</span></a><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.PLCTypes.html"><span class="hs-identifier">Language.PlutusTx.PLCTypes</span></a><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusIR.Compiler.Definitions</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusCore.Quote</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GhcPlugins</span><span>                             </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Reader</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">NE</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>                               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Syntax</span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TH</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-keyword">type</span><span> </span><a name="BuiltinNameInfo"><a href="Language.PlutusTx.Compiler.Types.html#BuiltinNameInfo"><span class="hs-identifier">BuiltinNameInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><span class="hs-identifier hs-type">TH.Name</span><span> </span><span class="hs-identifier hs-type">GHC.TyThing</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">newtype</span><span> </span><a name="ConversionOptions"><a href="Language.PlutusTx.Compiler.Types.html#ConversionOptions"><span class="hs-identifier">ConversionOptions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ConversionOptions"><a href="Language.PlutusTx.Compiler.Types.html#ConversionOptions"><span class="hs-identifier">ConversionOptions</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="coCheckValueRestriction"><a href="Language.PlutusTx.Compiler.Types.html#coCheckValueRestriction"><span class="hs-identifier">coCheckValueRestriction</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-keyword">data</span><span> </span><a name="ConvertingContext"><a href="Language.PlutusTx.Compiler.Types.html#ConvertingContext"><span class="hs-identifier">ConvertingContext</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ConvertingContext"><a href="Language.PlutusTx.Compiler.Types.html#ConvertingContext"><span class="hs-identifier">ConvertingContext</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-30"></a><span>    </span><a name="ccOpts"><a href="Language.PlutusTx.Compiler.Types.html#ccOpts"><span class="hs-identifier">ccOpts</span></a></a><span>            </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#ConversionOptions"><span class="hs-identifier hs-type">ConversionOptions</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>    </span><a name="ccFlags"><a href="Language.PlutusTx.Compiler.Types.html#ccFlags"><span class="hs-identifier">ccFlags</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">GHC.DynFlags</span><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>    </span><a name="ccBuiltinNameInfo"><a href="Language.PlutusTx.Compiler.Types.html#ccBuiltinNameInfo"><span class="hs-identifier">ccBuiltinNameInfo</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#BuiltinNameInfo"><span class="hs-identifier hs-type">BuiltinNameInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>    </span><a name="ccScopes"><a href="Language.PlutusTx.Compiler.Types.html#ccScopes"><span class="hs-identifier">ccScopes</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#ScopeStack"><span class="hs-identifier hs-type">ScopeStack</span></a><span>
</span><a name="line-34"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-comment">-- See Note [Scopes]</span><span>
</span><a name="line-37"></a><span class="hs-keyword">type</span><span> </span><a name="Converting"><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier">Converting</span></a></a><span> </span><a name="local-6989586621679190119"><a href="#local-6989586621679190119"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679190119"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadError</span><span> </span><a href="Language.PlutusTx.Compiler.Error.html#ConvError"><span class="hs-identifier hs-type">ConvError</span></a><span> </span><a href="#local-6989586621679190119"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadQuote</span><span> </span><a href="#local-6989586621679190119"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadReader</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#ConvertingContext"><span class="hs-identifier hs-type">ConvertingContext</span></a><span> </span><a href="#local-6989586621679190119"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadDefs</span><span> </span><span class="hs-identifier hs-type">GHC.Name</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679190119"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-comment">{- Note [Scopes]
We need a notion of scope, because we have to make sure that if we convert a GHC
Var into a variable, then we always convert it into the same variable, while also making
sure that if we encounter multiple things with the same name we produce fresh variables
appropriately.

So we have the usual mechanism of carrying around a stack of scopes.
-}</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-keyword">data</span><span> </span><a name="Scope"><a href="Language.PlutusTx.Compiler.Types.html#Scope"><span class="hs-identifier">Scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Scope"><a href="Language.PlutusTx.Compiler.Types.html#Scope"><span class="hs-identifier">Scope</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map.Map</span><span> </span><span class="hs-identifier hs-type">GHC.Name</span><span> </span><a href="Language.PlutusTx.PLCTypes.html#PLCVar"><span class="hs-identifier hs-type">PLCVar</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map.Map</span><span> </span><span class="hs-identifier hs-type">GHC.Name</span><span> </span><a href="Language.PlutusTx.PLCTypes.html#PLCTyVar"><span class="hs-identifier hs-type">PLCTyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">type</span><span> </span><a name="ScopeStack"><a href="Language.PlutusTx.Compiler.Types.html#ScopeStack"><span class="hs-identifier">ScopeStack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">NE.NonEmpty</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-identifier">initialScopeStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#ScopeStack"><span class="hs-identifier hs-type">ScopeStack</span></a><span>
</span><a name="line-52"></a><a name="initialScopeStack"><a href="Language.PlutusTx.Compiler.Types.html#initialScopeStack"><span class="hs-identifier">initialScopeStack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Scope"><span class="hs-identifier hs-var">Scope</span></a><span> </span><span class="hs-identifier hs-var">Map.empty</span><span> </span><span class="hs-identifier hs-var">Map.empty</span><span>
</span><a name="line-53"></a></pre></body></html>