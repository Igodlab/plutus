<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds   #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts  #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase        #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell   #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE TypeApplications  #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns      #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-comment">-- | Functions for compiling Plutus Core builtins.</span><span>
</span><a name="line-10"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.PlutusTx.Compiler.Builtins</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-11"></a><span>    </span><a href="Language.PlutusTx.Compiler.Builtins.html#builtinNames"><span class="hs-identifier hs-var">builtinNames</span></a><span>
</span><a name="line-12"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTypes"><span class="hs-identifier hs-var">defineBuiltinTypes</span></a><span>
</span><a name="line-13"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerms"><span class="hs-identifier hs-var">defineBuiltinTerms</span></a><span>
</span><a name="line-14"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#lookupBuiltinTerm"><span class="hs-identifier hs-var">lookupBuiltinTerm</span></a><span>
</span><a name="line-15"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#lookupBuiltinType"><span class="hs-identifier hs-var">lookupBuiltinType</span></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#errorTy"><span class="hs-identifier hs-var">errorTy</span></a><span>
</span><a name="line-17"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#errorFunc"><span class="hs-identifier hs-var">errorFunc</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Language.PlutusTx.Builtins.html"><span class="hs-identifier">Language.PlutusTx.Builtins</span></a><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Builtins</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.Error.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Error</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Language.PlutusTx.Compiler.Expr.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Expr</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.Names.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Names</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Language.PlutusTx.Compiler.Type.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Type</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.Types.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Types</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.Utils.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Utils</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.ValueRestriction.html"><span class="hs-identifier">Language.PlutusTx.Compiler.ValueRestriction</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.PIRTypes.html"><span class="hs-identifier">Language.PlutusTx.PIRTypes</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Utils.html"><span class="hs-identifier">Language.PlutusTx.Utils</span></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusIR</span><span>                           </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PIR</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusIR.Compiler.Definitions</span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PIR</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusIR.Compiler.Names</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusIR.MkPir</span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PIR</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusCore</span><span>                         </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PLC</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusCore.Constant</span><span>                </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PLC</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusCore.Constant.Dynamic</span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PLC</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusCore.Quote</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusCore.StdLib.Data.Bool</span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusCore.StdLib.Data.Unit</span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Unit</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GhcPlugins</span><span>                                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Syntax</span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TH</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Reader</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy</span><span>                        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BSL</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>                                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Proxy</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span>                                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-comment">{- Note [Mapping builtins]
We want the user to be able to call the Plutus builtins as normal Haskell functions.

To do this, we provide a library of such functions in Haskell, and we define corresponding
functions and types in PIR so that we can translate references to the Haskell functions and
types into references to the PIR ones.

We can then do whatever we need to inside the definitions to line things up with the real builtins.
(See Note [Builtin types and Haskell types])

To do this, we first need a map from the Haskell TH names to the corresponding GHC names
(in fact the TyThings, so we have the types too). Annoyingly, this has to be done in the
GHC Core monad and then passed to us.

This map lets us write code that defines all the builtins (by their TH names), and also to look
up things by their TH names in the few other cases where we need to (mostly where we use specific
known builtins to implement primitives).

This is a bit fragile, since we rely on having all the names that we need, and having them
mapped to the right things (GHC will panic on us if we e.g. get the wrong kind of TyThing for
a name). We should probably revisit this later.
-}</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-comment">{- Note [Builtin types and Haskell types]
Several of the PLC builtins use types that should (morally) line up with types that we compile from
Haskell. But there is a problem: they use either primitive or Scott-encoded versions of these types,
whereas when we compile them from Haskell they will end up as abstract types, and so the types
won't line up at the call site.

That is, we generate something like this:
(/\ (Int :: *) .
  (\ addInteger : Int -&gt; Int -&gt; Int .
      &lt;use addInteger&gt;
  )
  (\ x,y : Int . &lt;builtin addInteger&gt; x y) -- Uh oh, type error, can't show that Int = &lt;builtin int&gt;!
)
{&lt;builtin int&gt;}

We handle this in two different ways:
- For the types like Bool and Unit which are really algebraic types, and which have constructors etc.
that we care about elsewhere, we insert adaptor code into the definition of the builtin (see note [Mapping builtins]).
- For types like Int and Bytestring which don't have visible constructors, we can treat them as completely opaque,
and we use a transparent type alias. (Actually we fake the alias by actually just substituting the definition in
everywhere until we have aliases in PIR. Bear this in mind for the examples below.)

Here's how that looks for a primitive that takes Ints and returns a Boolean, assuming we have bound Int and Bool
already as an alias and an abstract type respectively:
(\ equalsInteger : Int -&gt; Int -&gt; Bool .
  &lt;use equalsInteger&gt;
)
(\ x, y : Int . -- No need to do anything to the arguments, since we're using a transparent alias for Int
  (&lt;builtin equalsInteger&gt; x y) {Bool} True False -- Immediately match the builtin bool into an abstract Bool
)

We *could* do something like the interleaved definitions that we do for datatypes in PIR. Morally this is perhaps the
right thing to do: we should think of Int and its builtins as a &quot;module&quot; that goes together and where all the definitions
have access to the internals of the other definitions. A datatype definition is then a special case of a module definition.
However, for the moment this would be quite a bit more design work and so we leave it for future work.

For an example of how the &quot;abstract module&quot; approach would look:
(/\ (Int :: *) .
  (\ addInteger : Int -&gt; Int -&gt; Int . -- Type signature is fine inside the abstraction
      &lt;use addInteger&gt;
  )
)
{&lt;builtin int&gt;}
(\ x,y : &lt;builtin int&gt; . &lt;builtin addInteger&gt; x y) -- No type error any more, abstraction is gone
-}</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">-- | The 'TH.Name's for which 'BuiltinNameInfo' needs to be provided.</span><span>
</span><a name="line-124"></a><span class="hs-identifier">builtinNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TH.Name</span><span class="hs-special">]</span><span>
</span><a name="line-125"></a><a name="builtinNames"><a href="Language.PlutusTx.Compiler.Builtins.html#builtinNames"><span class="hs-identifier">builtinNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-126"></a><span>    </span><span class="hs-special">''</span><span class="hs-identifier">BSL.ByteString</span><span>
</span><a name="line-127"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Bool</span><span>
</span><a name="line-129"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.concatenate</span><span>
</span><a name="line-132"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.takeByteString</span><span>
</span><a name="line-133"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.dropByteString</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.sha2_256</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.sha3_256</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.equalsByteString</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.verifySignature</span><span>
</span><a name="line-139"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.txhash</span><span>
</span><a name="line-140"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.blocknum</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.addInteger</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.subtractInteger</span><span>
</span><a name="line-144"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.multiplyInteger</span><span>
</span><a name="line-145"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.divideInteger</span><span>
</span><a name="line-146"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.remainderInteger</span><span>
</span><a name="line-147"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.greaterThanInteger</span><span>
</span><a name="line-148"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.greaterThanEqInteger</span><span>
</span><a name="line-149"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.lessThanInteger</span><span>
</span><a name="line-150"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.lessThanEqInteger</span><span>
</span><a name="line-151"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.equalsInteger</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.error</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Builtins.String</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Char</span><span>
</span><a name="line-157"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.appendString</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.emptyString</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.charToString</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.trace</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- | Get the 'GHC.TyThing' for a given 'TH.Name' which was stored in the builtin name info,</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- failing if it is missing.</span><span>
</span><a name="line-166"></a><span class="hs-identifier">getThing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293729"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">TH.Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679293729"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">GHC.TyThing</span><span>
</span><a name="line-167"></a><a name="getThing"><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier">getThing</span></a></a><span> </span><a name="local-6989586621679293730"><a href="#local-6989586621679293730"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-168"></a><span>    </span><a href="Language.PlutusTx.Compiler.Types.html#ConvertingContext"><span class="hs-identifier hs-var">ConvertingContext</span></a><span class="hs-special">{</span><span class="hs-identifier">ccBuiltinNameInfo</span><span class="hs-glyph">=</span><a name="local-6989586621679293731"><a href="#local-6989586621679293731"><span class="hs-identifier">names</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679293730"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679293731"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-170"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Utils.html#throwSd"><span class="hs-identifier hs-var">throwSd</span></a><span> </span><a href="Language.PlutusTx.Compiler.Error.html#ConversionError"><span class="hs-identifier hs-var">ConversionError</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Missing builtin name:&quot;</span><span> </span><span class="hs-operator hs-var">GHC.&lt;+&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.text</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679293730"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679293732"><a href="#local-6989586621679293732"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679293732"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-identifier">defineBuiltinTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293728"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">TH.Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">GHC.Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679293728"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-174"></a><a name="defineBuiltinTerm"><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier">defineBuiltinTerm</span></a></a><span> </span><a name="local-6989586621679293733"><a href="#local-6989586621679293733"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679293734"><a href="#local-6989586621679293734"><span class="hs-identifier">term</span></a></a><span> </span><a name="local-6989586621679293735"><a href="#local-6989586621679293735"><span class="hs-identifier">deps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-175"></a><span>    </span><a name="local-6989586621679295730"><a href="#local-6989586621679295730"><span class="hs-identifier">ghcId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.tyThingId</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier hs-var">getThing</span></a><span> </span><a href="#local-6989586621679293733"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-176"></a><span>    </span><a name="local-6989586621679295731"><a href="#local-6989586621679295731"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Names.html#convVarFresh"><span class="hs-identifier hs-var">convVarFresh</span></a><span> </span><a href="#local-6989586621679295730"><span class="hs-identifier hs-var">ghcId</span></a><span>
</span><a name="line-177"></a><span>    </span><span class="hs-identifier hs-var">PIR.defineTerm</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><a href="#local-6989586621679295730"><span class="hs-identifier hs-var">ghcId</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.Def</span><span> </span><a href="#local-6989586621679295731"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679293734"><span class="hs-identifier hs-var">term</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Set.fromList</span><span> </span><a href="#local-6989586621679293735"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span class="hs-comment">-- | Add definitions for all the builtin types to the environment.</span><span>
</span><a name="line-180"></a><span class="hs-identifier">defineBuiltinType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293727"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">TH.Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRType"><span class="hs-identifier hs-type">PIRType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">GHC.Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679293727"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-181"></a><a name="defineBuiltinType"><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinType"><span class="hs-identifier">defineBuiltinType</span></a></a><span> </span><a name="local-6989586621679295732"><a href="#local-6989586621679295732"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679295733"><a href="#local-6989586621679295733"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679295734"><a href="#local-6989586621679295734"><span class="hs-identifier">deps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-182"></a><span>    </span><a name="local-6989586621679295735"><a href="#local-6989586621679295735"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.tyThingTyCon</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier hs-var">getThing</span></a><span> </span><a href="#local-6989586621679295732"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-183"></a><span>    </span><a name="local-6989586621679295736"><a href="#local-6989586621679295736"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Names.html#convTcTyVarFresh"><span class="hs-identifier hs-var">convTcTyVarFresh</span></a><span> </span><a href="#local-6989586621679295735"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-184"></a><span>    </span><span class="hs-identifier hs-var">PIR.defineType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><a href="#local-6989586621679295735"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.Def</span><span> </span><a href="#local-6989586621679295736"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679295733"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Set.fromList</span><span> </span><a href="#local-6989586621679295734"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>    </span><span class="hs-comment">-- these are all aliases for now</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-identifier hs-var">PIR.recordAlias</span><span> </span><span class="hs-glyph">@</span><span class="hs-identifier hs-type">GHC.Name</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><a href="#local-6989586621679295735"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-comment">-- | Add definitions for all the builtin terms to the environment.</span><span>
</span><a name="line-189"></a><span class="hs-identifier">defineBuiltinTerms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293726"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679293726"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-190"></a><a name="defineBuiltinTerms"><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerms"><span class="hs-identifier">defineBuiltinTerms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-191"></a><span>    </span><a name="local-6989586621679295737"><a href="#local-6989586621679295737"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier hs-var">getThing</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">BSL.ByteString</span><span>
</span><a name="line-192"></a><span>    </span><a name="local-6989586621679295738"><a href="#local-6989586621679295738"><span class="hs-identifier">int</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier hs-var">getThing</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span><span>
</span><a name="line-193"></a><span>    </span><a name="local-6989586621679295739"><a href="#local-6989586621679295739"><span class="hs-identifier">bool</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier hs-var">getThing</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">Bool</span><span>
</span><a name="line-194"></a><span>    </span><span class="hs-keyword">unit</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier hs-var">getThing</span></a><span> </span><span class="hs-special">''</span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>    </span><a name="local-6989586621679295741"><a href="#local-6989586621679295741"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier hs-var">getThing</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">Builtins.String</span><span>
</span><a name="line-196"></a><span>    </span><a name="local-6989586621679295742"><a href="#local-6989586621679295742"><span class="hs-identifier">char</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier hs-var">getThing</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">Char</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span>    </span><span class="hs-comment">-- Bytestring builtins</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-200"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295743"><a href="#local-6989586621679295743"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellBSSize"><span class="hs-identifier hs-var">haskellBSSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#mkBuiltin"><span class="hs-identifier hs-var">mkBuiltin</span></a><span> </span><span class="hs-identifier hs-var">PLC.Concatenate</span><span>
</span><a name="line-201"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.concatenate</span><span> </span><a href="#local-6989586621679295743"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295737"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">]</span><span>
</span><a name="line-202"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-203"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295744"><a href="#local-6989586621679295744"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellBSSize"><span class="hs-identifier hs-var">haskellBSSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellIntSize"><span class="hs-identifier hs-var">haskellIntSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#mkBuiltin"><span class="hs-identifier hs-var">mkBuiltin</span></a><span> </span><span class="hs-identifier hs-var">PLC.TakeByteString</span><span>
</span><a name="line-204"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.takeByteString</span><span> </span><a href="#local-6989586621679295744"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679295737"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">]</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-206"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295745"><a href="#local-6989586621679295745"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellBSSize"><span class="hs-identifier hs-var">haskellBSSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellIntSize"><span class="hs-identifier hs-var">haskellIntSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#mkBuiltin"><span class="hs-identifier hs-var">mkBuiltin</span></a><span> </span><span class="hs-identifier hs-var">PLC.DropByteString</span><span>
</span><a name="line-207"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.dropByteString</span><span> </span><a href="#local-6989586621679295745"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679295737"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">]</span><span>
</span><a name="line-208"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-209"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295746"><a href="#local-6989586621679295746"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellBSSize"><span class="hs-identifier hs-var">haskellBSSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#mkBuiltin"><span class="hs-identifier hs-var">mkBuiltin</span></a><span> </span><span class="hs-identifier hs-var">PLC.SHA2</span><span>
</span><a name="line-210"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.sha2_256</span><span> </span><a href="#local-6989586621679295746"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295737"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">]</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-212"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295747"><a href="#local-6989586621679295747"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellBSSize"><span class="hs-identifier hs-var">haskellBSSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#mkBuiltin"><span class="hs-identifier hs-var">mkBuiltin</span></a><span> </span><span class="hs-identifier hs-var">PLC.SHA3</span><span>
</span><a name="line-213"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.sha3_256</span><span> </span><a href="#local-6989586621679295747"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295737"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">]</span><span>
</span><a name="line-214"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-215"></a><span>        </span><a name="local-6989586621679295748"><a href="#local-6989586621679295748"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#mkBsRel"><span class="hs-identifier hs-var">mkBsRel</span></a><span> </span><span class="hs-identifier hs-var">PLC.EqByteString</span><span>
</span><a name="line-216"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.equalsByteString</span><span> </span><a href="#local-6989586621679295748"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295737"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679295739"><span class="hs-identifier hs-var">bool</span></a><span class="hs-special">]</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span>    </span><span class="hs-comment">-- Integer builtins</span><span>
</span><a name="line-219"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-220"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295749"><a href="#local-6989586621679295749"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#mkIntFun"><span class="hs-identifier hs-var">mkIntFun</span></a><span> </span><span class="hs-identifier hs-var">PLC.AddInteger</span><span>
</span><a name="line-221"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.addInteger</span><span> </span><a href="#local-6989586621679295749"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">]</span><span>
</span><a name="line-222"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-223"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295750"><a href="#local-6989586621679295750"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#mkIntFun"><span class="hs-identifier hs-var">mkIntFun</span></a><span> </span><span class="hs-identifier hs-var">PLC.SubtractInteger</span><span>
</span><a name="line-224"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.subtractInteger</span><span> </span><a href="#local-6989586621679295750"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">]</span><span>
</span><a name="line-225"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-226"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295751"><a href="#local-6989586621679295751"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#mkIntFun"><span class="hs-identifier hs-var">mkIntFun</span></a><span> </span><span class="hs-identifier hs-var">PLC.MultiplyInteger</span><span>
</span><a name="line-227"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.multiplyInteger</span><span> </span><a href="#local-6989586621679295751"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">]</span><span>
</span><a name="line-228"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-229"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295752"><a href="#local-6989586621679295752"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#mkIntFun"><span class="hs-identifier hs-var">mkIntFun</span></a><span> </span><span class="hs-identifier hs-var">PLC.DivideInteger</span><span>
</span><a name="line-230"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.divideInteger</span><span> </span><a href="#local-6989586621679295752"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">]</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-232"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295753"><a href="#local-6989586621679295753"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#mkIntFun"><span class="hs-identifier hs-var">mkIntFun</span></a><span> </span><span class="hs-identifier hs-var">PLC.RemainderInteger</span><span>
</span><a name="line-233"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.remainderInteger</span><span> </span><a href="#local-6989586621679295753"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">]</span><span>
</span><a name="line-234"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-235"></a><span>        </span><a name="local-6989586621679295754"><a href="#local-6989586621679295754"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#mkIntRel"><span class="hs-identifier hs-var">mkIntRel</span></a><span> </span><span class="hs-identifier hs-var">PLC.GreaterThanInteger</span><span>
</span><a name="line-236"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.greaterThanInteger</span><span> </span><a href="#local-6989586621679295754"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679295739"><span class="hs-identifier hs-var">bool</span></a><span class="hs-special">]</span><span>
</span><a name="line-237"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-238"></a><span>        </span><a name="local-6989586621679295755"><a href="#local-6989586621679295755"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#mkIntRel"><span class="hs-identifier hs-var">mkIntRel</span></a><span> </span><span class="hs-identifier hs-var">PLC.GreaterThanEqInteger</span><span>
</span><a name="line-239"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.greaterThanEqInteger</span><span> </span><a href="#local-6989586621679295755"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679295739"><span class="hs-identifier hs-var">bool</span></a><span class="hs-special">]</span><span>
</span><a name="line-240"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-241"></a><span>        </span><a name="local-6989586621679295756"><a href="#local-6989586621679295756"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#mkIntRel"><span class="hs-identifier hs-var">mkIntRel</span></a><span> </span><span class="hs-identifier hs-var">PLC.LessThanInteger</span><span>
</span><a name="line-242"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.lessThanInteger</span><span> </span><a href="#local-6989586621679295756"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679295739"><span class="hs-identifier hs-var">bool</span></a><span class="hs-special">]</span><span>
</span><a name="line-243"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-244"></a><span>        </span><a name="local-6989586621679295757"><a href="#local-6989586621679295757"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#mkIntRel"><span class="hs-identifier hs-var">mkIntRel</span></a><span> </span><span class="hs-identifier hs-var">PLC.LessThanEqInteger</span><span>
</span><a name="line-245"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.lessThanEqInteger</span><span> </span><a href="#local-6989586621679295757"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679295739"><span class="hs-identifier hs-var">bool</span></a><span class="hs-special">]</span><span>
</span><a name="line-246"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-247"></a><span>        </span><a name="local-6989586621679295758"><a href="#local-6989586621679295758"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#mkIntRel"><span class="hs-identifier hs-var">mkIntRel</span></a><span> </span><span class="hs-identifier hs-var">PLC.EqInteger</span><span>
</span><a name="line-248"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.equalsInteger</span><span> </span><a href="#local-6989586621679295758"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295738"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679295739"><span class="hs-identifier hs-var">bool</span></a><span class="hs-special">]</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span>    </span><span class="hs-comment">-- Blockchain builtins</span><span>
</span><a name="line-251"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-252"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295759"><a href="#local-6989586621679295759"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#mkBuiltin"><span class="hs-identifier hs-var">mkBuiltin</span></a><span> </span><span class="hs-identifier hs-var">PLC.TxHash</span><span>
</span><a name="line-253"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.txhash</span><span> </span><a href="#local-6989586621679295759"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295737"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">]</span><span>
</span><a name="line-254"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-255"></a><span>        </span><a name="local-6989586621679295760"><a href="#local-6989586621679295760"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#wrapBsRel"><span class="hs-identifier hs-var">wrapBsRel</span></a><span> </span><span class="hs-number">3</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellBSSize"><span class="hs-identifier hs-var">haskellBSSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellBSSize"><span class="hs-identifier hs-var">haskellBSSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellBSSize"><span class="hs-identifier hs-var">haskellBSSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#mkBuiltin"><span class="hs-identifier hs-var">mkBuiltin</span></a><span> </span><span class="hs-identifier hs-var">PLC.VerifySignature</span><span>
</span><a name="line-256"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.verifySignature</span><span> </span><a href="#local-6989586621679295760"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295737"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679295739"><span class="hs-identifier hs-var">bool</span></a><span class="hs-special">]</span><span>
</span><a name="line-257"></a><span>    </span><span class="hs-comment">-- TODO: blocknum, this is annoying because we want to actually apply it to a size, which currently crashes in the evaluator</span><span>
</span><a name="line-258"></a><span>    </span><span class="hs-comment">-- as it's unimplemented</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span>    </span><span class="hs-comment">-- Error</span><span>
</span><a name="line-261"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-262"></a><span>        </span><a name="local-6989586621679295761"><a href="#local-6989586621679295761"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#errorFunc"><span class="hs-identifier hs-var">errorFunc</span></a><span>
</span><a name="line-263"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.error</span><span> </span><a href="#local-6989586621679295761"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><span class="hs-keyword">unit</span><span class="hs-special">]</span><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span>    </span><span class="hs-comment">-- Strings and chars</span><span>
</span><a name="line-266"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-267"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295762"><a href="#local-6989586621679295762"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#mkDynBuiltin"><span class="hs-identifier hs-var">mkDynBuiltin</span></a><span> </span><span class="hs-identifier hs-var">PLC.dynamicAppendName</span><span>
</span><a name="line-268"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.appendString</span><span> </span><a href="#local-6989586621679295762"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295741"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">]</span><span>
</span><a name="line-269"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-270"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295816"><a href="#local-6989586621679295816"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PIR.Constant</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PLC.BuiltinStr</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-271"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.emptyString</span><span> </span><a href="#local-6989586621679295816"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295741"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">]</span><span>
</span><a name="line-272"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-273"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295817"><a href="#local-6989586621679295817"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#mkDynBuiltin"><span class="hs-identifier hs-var">mkDynBuiltin</span></a><span> </span><span class="hs-identifier hs-var">PLC.dynamicCharToStringName</span><span>
</span><a name="line-274"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.charToString</span><span> </span><a href="#local-6989586621679295817"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295742"><span class="hs-identifier hs-var">char</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679295741"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">]</span><span>
</span><a name="line-275"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-276"></a><span>        </span><a name="local-6989586621679295818"><a href="#local-6989586621679295818"><span class="hs-identifier">strTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#lookupBuiltinType"><span class="hs-identifier hs-var">lookupBuiltinType</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">Builtins.String</span><span>
</span><a name="line-277"></a><span>        </span><a name="local-6989586621679295819"><a href="#local-6989586621679295819"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#wrapUnitFun"><span class="hs-identifier hs-var">wrapUnitFun</span></a><span> </span><a href="#local-6989586621679295818"><span class="hs-identifier hs-var">strTy</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#mkDynBuiltin"><span class="hs-identifier hs-var">mkDynBuiltin</span></a><span> </span><span class="hs-identifier hs-var">PLC.dynamicTraceName</span><span>
</span><a name="line-278"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTerm"><span class="hs-identifier hs-var">defineBuiltinTerm</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">Builtins.trace</span><span> </span><a href="#local-6989586621679295819"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295741"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">unit</span><span class="hs-special">]</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span class="hs-identifier">defineBuiltinTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293725"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679293725"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><a name="defineBuiltinTypes"><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinTypes"><span class="hs-identifier">defineBuiltinTypes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-282"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-283"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295820"><a href="#local-6989586621679295820"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#appSize"><span class="hs-identifier hs-var">appSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellBSSize"><span class="hs-identifier hs-var">haskellBSSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PLC.TyBuiltin</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">PLC.TyByteString</span><span>
</span><a name="line-284"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinType"><span class="hs-identifier hs-var">defineBuiltinType</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">BSL.ByteString</span><span> </span><a href="#local-6989586621679295820"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-285"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-286"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679295821"><a href="#local-6989586621679295821"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Utils.html#appSize"><span class="hs-identifier hs-var">appSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellIntSize"><span class="hs-identifier hs-var">haskellIntSize</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PLC.TyBuiltin</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">PLC.TyInteger</span><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinType"><span class="hs-identifier hs-var">defineBuiltinType</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span><span> </span><a href="#local-6989586621679295821"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span>    </span><span class="hs-comment">-- Strings and chars</span><span>
</span><a name="line-290"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-291"></a><span>        </span><a name="local-6989586621679296287"><a href="#local-6989586621679296287"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftQuote</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PLC.getTypeEncoding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-292"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinType"><span class="hs-identifier hs-var">defineBuiltinType</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">Builtins.String</span><span> </span><a href="#local-6989586621679296287"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-293"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-294"></a><span>        </span><a name="local-6989586621679296288"><a href="#local-6989586621679296288"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftQuote</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PLC.getTypeEncoding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span>
</span><a name="line-295"></a><span>        </span><a href="Language.PlutusTx.Compiler.Builtins.html#defineBuiltinType"><span class="hs-identifier hs-var">defineBuiltinType</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">Char</span><span> </span><a href="#local-6989586621679296288"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span class="hs-comment">-- | Lookup a builtin term by its TH name. These are assumed to be present, so fails if it cannot find it.</span><span>
</span><a name="line-298"></a><span class="hs-identifier">lookupBuiltinTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293724"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">TH.Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679293724"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span>
</span><a name="line-299"></a><a name="lookupBuiltinTerm"><a href="Language.PlutusTx.Compiler.Builtins.html#lookupBuiltinTerm"><span class="hs-identifier">lookupBuiltinTerm</span></a></a><span> </span><a name="local-6989586621679296289"><a href="#local-6989586621679296289"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-300"></a><span>    </span><a name="local-6989586621679296290"><a href="#local-6989586621679296290"><span class="hs-identifier">ghcName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier hs-var">getThing</span></a><span> </span><a href="#local-6989586621679296289"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-301"></a><span>    </span><a name="local-6989586621679296291"><a href="#local-6989586621679296291"><span class="hs-identifier">maybeTerm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">PIR.lookupTerm</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296290"><span class="hs-identifier hs-var">ghcName</span></a><span>
</span><a name="line-302"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679296291"><span class="hs-identifier hs-var">maybeTerm</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-303"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679296292"><a href="#local-6989586621679296292"><span class="hs-identifier">t</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679296292"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-304"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Utils.html#throwSd"><span class="hs-identifier hs-var">throwSd</span></a><span> </span><a href="Language.PlutusTx.Compiler.Error.html#ConversionError"><span class="hs-identifier hs-var">ConversionError</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Missing builtin definition:&quot;</span><span> </span><span class="hs-operator hs-var">GHC.&lt;+&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.text</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679296289"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-comment">-- | Lookup a builtin type by its TH name. These are assumed to be present, so fails if it is cannot find it.</span><span>
</span><a name="line-307"></a><span class="hs-identifier">lookupBuiltinType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293723"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">TH.Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679293723"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRType"><span class="hs-identifier hs-type">PIRType</span></a><span>
</span><a name="line-308"></a><a name="lookupBuiltinType"><a href="Language.PlutusTx.Compiler.Builtins.html#lookupBuiltinType"><span class="hs-identifier">lookupBuiltinType</span></a></a><span> </span><a name="local-6989586621679296293"><a href="#local-6989586621679296293"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-309"></a><span>    </span><a name="local-6989586621679296294"><a href="#local-6989586621679296294"><span class="hs-identifier">ghcName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.getName</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#getThing"><span class="hs-identifier hs-var">getThing</span></a><span> </span><a href="#local-6989586621679296293"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-310"></a><span>    </span><a name="local-6989586621679296295"><a href="#local-6989586621679296295"><span class="hs-identifier">maybeType</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">PIR.lookupType</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296294"><span class="hs-identifier hs-var">ghcName</span></a><span>
</span><a name="line-311"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679296295"><span class="hs-identifier hs-var">maybeType</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-312"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679296296"><a href="#local-6989586621679296296"><span class="hs-identifier">t</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679296296"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-313"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.Compiler.Utils.html#throwSd"><span class="hs-identifier hs-var">throwSd</span></a><span> </span><a href="Language.PlutusTx.Compiler.Error.html#ConversionError"><span class="hs-identifier hs-var">ConversionError</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Missing builtin definition:&quot;</span><span> </span><span class="hs-operator hs-var">GHC.&lt;+&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.text</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679296293"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-314"></a><span>
</span><a name="line-315"></a><span class="hs-comment">-- | The function 'error :: forall a . () -&gt; a'.</span><span>
</span><a name="line-316"></a><span class="hs-identifier">errorFunc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293722"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679293722"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span>
</span><a name="line-317"></a><a name="errorFunc"><a href="Language.PlutusTx.Compiler.Builtins.html#errorFunc"><span class="hs-identifier">errorFunc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-318"></a><span>    </span><a name="local-6989586621679296297"><a href="#local-6989586621679296297"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">safeFreshTyName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;e&quot;</span><span>
</span><a name="line-319"></a><span>    </span><span class="hs-comment">-- see Note [Value restriction]</span><span>
</span><a name="line-320"></a><span>    </span><a href="Language.PlutusTx.Compiler.ValueRestriction.html#mangleTyAbs"><span class="hs-identifier hs-var">mangleTyAbs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PIR.TyAbs</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296297"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.Type</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.Error</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.TyVar</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296297"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-comment">-- | The type 'forall a. () -&gt; a'.</span><span>
</span><a name="line-323"></a><span class="hs-identifier">errorTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293721"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679293721"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRType"><span class="hs-identifier hs-type">PIRType</span></a><span>
</span><a name="line-324"></a><a name="errorTy"><a href="Language.PlutusTx.Compiler.Builtins.html#errorTy"><span class="hs-identifier">errorTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-325"></a><span>    </span><a name="local-6989586621679296298"><a href="#local-6989586621679296298"><span class="hs-identifier">tyname</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">safeFreshTyName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;a&quot;</span><span>
</span><a name="line-326"></a><span>    </span><a href="Language.PlutusTx.Compiler.ValueRestriction.html#mangleTyForall"><span class="hs-identifier hs-var">mangleTyForall</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PIR.TyForall</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296298"><span class="hs-identifier hs-var">tyname</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.Type</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.TyVar</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296298"><span class="hs-identifier hs-var">tyname</span></a><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-comment">-- TODO: bind the converter to a name too. Need an appropriate GHC.Name for</span><span>
</span><a name="line-329"></a><span class="hs-comment">-- it, since that's what our definitions are hung off. Also the type wouldn't</span><span>
</span><a name="line-330"></a><span class="hs-comment">-- be a simple conversion of the Haskell type, because it takes a Scott boolean.</span><span>
</span><a name="line-331"></a><span class="hs-comment">-- | Convert a Scott-encoded Boolean into a Haskell Boolean.</span><span>
</span><a name="line-332"></a><span class="hs-identifier">scottBoolToHaskellBool</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293720"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679293720"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span>
</span><a name="line-333"></a><a name="scottBoolToHaskellBool"><a href="Language.PlutusTx.Compiler.Builtins.html#scottBoolToHaskellBool"><span class="hs-identifier">scottBoolToHaskellBool</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-334"></a><span>    </span><a name="local-6989586621679296299"><a href="#local-6989586621679296299"><span class="hs-identifier">scottBoolTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftQuote</span><span> </span><span class="hs-identifier hs-var">Bool.getBuiltinBool</span><span>
</span><a name="line-335"></a><span>    </span><a name="local-6989586621679296300"><a href="#local-6989586621679296300"><span class="hs-identifier">haskellBoolTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Type.html#convType"><span class="hs-identifier hs-var">convType</span></a><span> </span><span class="hs-identifier hs-var">GHC.boolTy</span><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span>    </span><a name="local-6989586621679296301"><a href="#local-6989586621679296301"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftQuote</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">freshName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;b&quot;</span><span>
</span><a name="line-338"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679296302"><a href="#local-6989586621679296302"><span class="hs-identifier">match</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PIR.Var</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296301"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-339"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679296303"><a href="#local-6989586621679296303"><span class="hs-identifier">instantiatedMatch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PIR.TyInst</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296302"><span class="hs-identifier hs-var">match</span></a><span> </span><a href="#local-6989586621679296300"><span class="hs-identifier hs-var">haskellBoolTy</span></a><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span>    </span><a name="local-6989586621679296304"><a href="#local-6989586621679296304"><span class="hs-identifier">haskellTrue</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Expr.html#convDataConRef"><span class="hs-identifier hs-var">convDataConRef</span></a><span> </span><span class="hs-identifier hs-var">GHC.trueDataCon</span><span>
</span><a name="line-342"></a><span>    </span><a name="local-6989586621679296305"><a href="#local-6989586621679296305"><span class="hs-identifier">haskellFalse</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Expr.html#convDataConRef"><span class="hs-identifier hs-var">convDataConRef</span></a><span> </span><span class="hs-identifier hs-var">GHC.falseDataCon</span><span>
</span><a name="line-343"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-344"></a><span>        </span><span class="hs-identifier hs-var">PIR.LamAbs</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296301"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679296299"><span class="hs-identifier hs-var">scottBoolTy</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-345"></a><span>        </span><span class="hs-identifier hs-var">PIR.mkIterApp</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296303"><span class="hs-identifier hs-var">instantiatedMatch</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679296304"><span class="hs-identifier hs-var">haskellTrue</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679296305"><span class="hs-identifier hs-var">haskellFalse</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-346"></a><span>
</span><a name="line-347"></a><span class="hs-comment">-- | Wrap an integer relation of arity @n@ that produces a Scott boolean.</span><span>
</span><a name="line-348"></a><span class="hs-identifier">wrapIntRel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293719"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679293719"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span>
</span><a name="line-349"></a><a name="wrapIntRel"><a href="Language.PlutusTx.Compiler.Builtins.html#wrapIntRel"><span class="hs-identifier">wrapIntRel</span></a></a><span> </span><a name="local-6989586621679296306"><a href="#local-6989586621679296306"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621679296307"><a href="#local-6989586621679296307"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-350"></a><span>    </span><a name="local-6989586621679296308"><a href="#local-6989586621679296308"><span class="hs-identifier">intTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#lookupBuiltinType"><span class="hs-identifier hs-var">lookupBuiltinType</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span><span>
</span><a name="line-351"></a><span>    </span><a name="local-6989586621679296310"><a href="#local-6989586621679296310"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">replicateM</span><span> </span><a href="#local-6989586621679296306"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-352"></a><span>        </span><a name="local-6989586621679296309"><a href="#local-6989586621679296309"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">safeFreshName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;arg&quot;</span><span>
</span><a name="line-353"></a><span>        </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PIR.VarDecl</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296309"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679296308"><span class="hs-identifier hs-var">intTy</span></a><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span>    </span><span class="hs-comment">-- TODO: bind the converter to a name too</span><span>
</span><a name="line-356"></a><span>    </span><a name="local-6989586621679296311"><a href="#local-6989586621679296311"><span class="hs-identifier">converter</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#scottBoolToHaskellBool"><span class="hs-identifier hs-var">scottBoolToHaskellBool</span></a><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-359"></a><span>        </span><span class="hs-identifier hs-var">PIR.mkIterLamAbs</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296310"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-360"></a><span>        </span><span class="hs-identifier hs-var">PIR.Apply</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296311"><span class="hs-identifier hs-var">converter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.mkIterApp</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296307"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.mkVar</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296310"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-identifier">mkIntRel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293718"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">PLC.BuiltinName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679293718"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span>
</span><a name="line-363"></a><a name="mkIntRel"><a href="Language.PlutusTx.Compiler.Builtins.html#mkIntRel"><span class="hs-identifier">mkIntRel</span></a></a><span> </span><a name="local-6989586621679296312"><a href="#local-6989586621679296312"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#wrapIntRel"><span class="hs-identifier hs-var">wrapIntRel</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellIntSize"><span class="hs-identifier hs-var">haskellIntSize</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusTx.Utils.html#mkBuiltin"><span class="hs-identifier hs-var">mkBuiltin</span></a><span> </span><a href="#local-6989586621679296312"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span class="hs-comment">-- | Wrap an bytestring relation of arity @n@ that produces a Scott boolean.</span><span>
</span><a name="line-366"></a><span class="hs-identifier">wrapBsRel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293717"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679293717"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span>
</span><a name="line-367"></a><a name="wrapBsRel"><a href="Language.PlutusTx.Compiler.Builtins.html#wrapBsRel"><span class="hs-identifier">wrapBsRel</span></a></a><span> </span><a name="local-6989586621679296313"><a href="#local-6989586621679296313"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621679296314"><a href="#local-6989586621679296314"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-368"></a><span>    </span><a name="local-6989586621679296315"><a href="#local-6989586621679296315"><span class="hs-identifier">bsTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#lookupBuiltinType"><span class="hs-identifier hs-var">lookupBuiltinType</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">BSL.ByteString</span><span>
</span><a name="line-369"></a><span>    </span><a name="local-6989586621679296317"><a href="#local-6989586621679296317"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">replicateM</span><span> </span><a href="#local-6989586621679296313"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-370"></a><span>        </span><a name="local-6989586621679296316"><a href="#local-6989586621679296316"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">safeFreshName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;arg&quot;</span><span>
</span><a name="line-371"></a><span>        </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PIR.VarDecl</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296316"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679296315"><span class="hs-identifier hs-var">bsTy</span></a><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span>    </span><a name="local-6989586621679296318"><a href="#local-6989586621679296318"><span class="hs-identifier">converter</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#scottBoolToHaskellBool"><span class="hs-identifier hs-var">scottBoolToHaskellBool</span></a><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-376"></a><span>        </span><span class="hs-identifier hs-var">PIR.mkIterLamAbs</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296317"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-377"></a><span>        </span><span class="hs-identifier hs-var">PIR.Apply</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296318"><span class="hs-identifier hs-var">converter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.mkIterApp</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296314"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.mkVar</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296317"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-identifier">mkBsRel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293716"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">PLC.BuiltinName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679293716"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span>
</span><a name="line-380"></a><a name="mkBsRel"><a href="Language.PlutusTx.Compiler.Builtins.html#mkBsRel"><span class="hs-identifier">mkBsRel</span></a></a><span> </span><a name="local-6989586621679296319"><a href="#local-6989586621679296319"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#wrapBsRel"><span class="hs-identifier hs-var">wrapBsRel</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Utils.html#instSize"><span class="hs-identifier hs-var">instSize</span></a><span> </span><a href="Language.PlutusTx.Utils.html#haskellBSSize"><span class="hs-identifier hs-var">haskellBSSize</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusTx.Utils.html#mkBuiltin"><span class="hs-identifier hs-var">mkBuiltin</span></a><span> </span><a href="#local-6989586621679296319"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-381"></a><span>
</span><a name="line-382"></a><span class="hs-comment">-- | Convert a Scott-encoded Unit into a Haskell Unit.</span><span>
</span><a name="line-383"></a><span class="hs-identifier">scottUnitToHaskellUnit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293715"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679293715"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span>
</span><a name="line-384"></a><a name="scottUnitToHaskellUnit"><a href="Language.PlutusTx.Compiler.Builtins.html#scottUnitToHaskellUnit"><span class="hs-identifier">scottUnitToHaskellUnit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-385"></a><span>    </span><a name="local-6989586621679296320"><a href="#local-6989586621679296320"><span class="hs-identifier">scottUnitTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftQuote</span><span> </span><span class="hs-identifier hs-var">Unit.getBuiltinUnit</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span>    </span><a name="local-6989586621679296321"><a href="#local-6989586621679296321"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftQuote</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">freshName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;b&quot;</span><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span>    </span><a name="local-6989586621679296322"><a href="#local-6989586621679296322"><span class="hs-identifier">haskellUnitVal</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Expr.html#convDataConRef"><span class="hs-identifier hs-var">convDataConRef</span></a><span> </span><span class="hs-identifier hs-var">GHC.unitDataCon</span><span>
</span><a name="line-390"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PIR.LamAbs</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296321"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679296320"><span class="hs-identifier hs-var">scottUnitTy</span></a><span> </span><a href="#local-6989586621679296322"><span class="hs-identifier hs-var">haskellUnitVal</span></a><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-comment">-- | Wrap an function with the given argument type that produces a Scott unit.</span><span>
</span><a name="line-393"></a><span class="hs-identifier">wrapUnitFun</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#Converting"><span class="hs-identifier hs-type">Converting</span></a><span> </span><a href="#local-6989586621679293714"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRType"><span class="hs-identifier hs-type">PIRType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679293714"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.PlutusTx.PIRTypes.html#PIRTerm"><span class="hs-identifier hs-type">PIRTerm</span></a><span>
</span><a name="line-394"></a><a name="wrapUnitFun"><a href="Language.PlutusTx.Compiler.Builtins.html#wrapUnitFun"><span class="hs-identifier">wrapUnitFun</span></a></a><span> </span><a name="local-6989586621679296323"><a href="#local-6989586621679296323"><span class="hs-identifier">argTy</span></a></a><span> </span><a name="local-6989586621679296324"><a href="#local-6989586621679296324"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-395"></a><span>    </span><a name="local-6989586621679296326"><a href="#local-6989586621679296326"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-396"></a><span>        </span><a name="local-6989586621679296325"><a href="#local-6989586621679296325"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">safeFreshName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;arg&quot;</span><span>
</span><a name="line-397"></a><span>        </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PIR.VarDecl</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296325"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679296323"><span class="hs-identifier hs-var">argTy</span></a><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span>    </span><a name="local-6989586621679296327"><a href="#local-6989586621679296327"><span class="hs-identifier">converter</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#scottUnitToHaskellUnit"><span class="hs-identifier hs-var">scottUnitToHaskellUnit</span></a><span>
</span><a name="line-400"></a><span>
</span><a name="line-401"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-402"></a><span>        </span><span class="hs-identifier hs-var">PIR.mkIterLamAbs</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679296326"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-403"></a><span>        </span><span class="hs-identifier hs-var">PIR.Apply</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296327"><span class="hs-identifier hs-var">converter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.Apply</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296324"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.mkVar</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296326"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-404"></a></pre></body></html>