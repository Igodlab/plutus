<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds                  #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DerivingStrategies         #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures             #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase                 #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings          #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell            #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE TupleSections              #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE TypeApplications           #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns               #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unused-foralls #-}</span><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.PlutusTx.Plugin</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-13"></a><span>    </span><a href="Language.PlutusTx.Plugin.html#CompiledCode"><span class="hs-identifier hs-type">CompiledCode</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>    </span><a href="Language.PlutusTx.Plugin.html#getSerializedPlc"><span class="hs-identifier hs-var">getSerializedPlc</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>    </span><a href="Language.PlutusTx.Plugin.html#getSerializedPir"><span class="hs-identifier hs-var">getSerializedPir</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>    </span><a href="Language.PlutusTx.Plugin.html#getPlc"><span class="hs-identifier hs-var">getPlc</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>    </span><a href="Language.PlutusTx.Plugin.html#getPir"><span class="hs-identifier hs-var">getPir</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>    </span><a href="Language.PlutusTx.Plugin.html#plugin"><span class="hs-identifier hs-var">plugin</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>    </span><a href="Language.PlutusTx.Plugin.html#plc"><span class="hs-identifier hs-var">plc</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.Builtins.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Builtins</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.Error.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Error</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.Expr.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Expr</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.Types.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Types</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Compiler.Utils.html"><span class="hs-identifier">Language.PlutusTx.Compiler.Utils</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Language.PlutusTx.Lift.Class.html"><span class="hs-identifier">Language.PlutusTx.Lift.Class</span></a><span>           </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Lift</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.PIRTypes.html"><span class="hs-identifier">Language.PlutusTx.PIRTypes</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.PLCTypes.html"><span class="hs-identifier">Language.PlutusTx.PLCTypes</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusTx.Utils.html"><span class="hs-identifier">Language.PlutusTx.Utils</span></a><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GhcPlugins</span><span>                             </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Panic</span><span>                                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusCore</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PLC</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusCore.Constant</span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PLC</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusCore.Constant.Dynamic</span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PLC</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusCore.Quote</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusIR</span><span>                      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PIR</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusIR.Compiler</span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PIR</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusIR.Compiler.Definitions</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PIR</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusIR.Optimizer.DeadCode</span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PIR</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.Haskell.TH.Syntax</span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TH</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Codec.Serialise</span><span>                        </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DeserialiseFailure</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">deserialiseOrFail</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">serialise</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Exception</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Reader</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString</span><span>                        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy</span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BSL</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Unsafe</span><span>                 </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BSUnsafe</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>                               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Prettyprint.Doc</span><span>              </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PP</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.TypeLits</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">System.IO.Unsafe</span><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafePerformIO</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- | A compiled Plutus Tx program. The type parameter inicates</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- the type of the Haskell expression that was compiled, and</span><span>
</span><a name="line-63"></a><span class="hs-comment">-- hence the type of the compiled code.</span><span>
</span><a name="line-64"></a><span class="hs-keyword">data</span><span> </span><a name="CompiledCode"><a href="Language.PlutusTx.Plugin.html#CompiledCode"><span class="hs-identifier">CompiledCode</span></a></a><span> </span><a name="local-6989586621679368530"><a href="#local-6989586621679368530"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CompiledCode"><a href="Language.PlutusTx.Plugin.html#CompiledCode"><span class="hs-identifier">CompiledCode</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-65"></a><span>    </span><a name="serializedPlc"><a href="Language.PlutusTx.Plugin.html#serializedPlc"><span class="hs-identifier">serializedPlc</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BS.ByteString</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="serializedPir"><a href="Language.PlutusTx.Plugin.html#serializedPir"><span class="hs-identifier">serializedPir</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BS.ByteString</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">-- Note that we do *not* have a TypeablePlc instance, since we don't know what the type is. We could in principle store it after the plugin</span><span>
</span><a name="line-70"></a><span class="hs-comment">-- typechecks the code, but we don't currently.</span><span>
</span><a name="line-71"></a><span class="hs-keyword">instance</span><span> </span><a href="Language.PlutusTx.Lift.Class.html#Lift"><span class="hs-identifier hs-type">Lift.Lift</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusTx.Plugin.html#CompiledCode"><span class="hs-identifier hs-type">CompiledCode</span></a><span> </span><a href="#local-6989586621679368532"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-72"></a><span>    </span><a name="local-8214565720323884966"><a href="Language.PlutusTx.Lift.Class.html#lift"><span class="hs-identifier">lift</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusTx.Plugin.html#getPlc"><span class="hs-identifier hs-var">getPlc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PLC.Program</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679368533"><a href="#local-6989586621679368533"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PIR.embedIntoIR</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">PLC.rename</span><span> </span><a href="#local-6989586621679368533"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-identifier">getSerializedPlc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Plugin.html#CompiledCode"><span class="hs-identifier hs-type">CompiledCode</span></a><span> </span><a href="#local-6989586621679369788"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BSL.ByteString</span><span>
</span><a name="line-75"></a><a name="getSerializedPlc"><a href="Language.PlutusTx.Plugin.html#getSerializedPlc"><span class="hs-identifier">getSerializedPlc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BSL.fromStrict</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">serializedPlc</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-identifier">getSerializedPir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Plugin.html#CompiledCode"><span class="hs-identifier hs-type">CompiledCode</span></a><span> </span><a href="#local-6989586621679369787"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BSL.ByteString</span><span>
</span><a name="line-78"></a><a name="getSerializedPir"><a href="Language.PlutusTx.Plugin.html#getSerializedPir"><span class="hs-identifier">getSerializedPir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BSL.fromStrict</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">serializedPir</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">{- Note [Deserializing the AST]
The types suggest that we can fail to deserialize the AST that we embedded in the program.
However, we just did it ourselves, so this should be impossible, and we signal this with an
exception.
-}</span><span>
</span><a name="line-85"></a><span class="hs-keyword">newtype</span><span> </span><a name="ImpossibleDeserialisationFailure"><a href="Language.PlutusTx.Plugin.html#ImpossibleDeserialisationFailure"><span class="hs-identifier">ImpossibleDeserialisationFailure</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ImpossibleDeserialisationFailure"><a href="Language.PlutusTx.Plugin.html#ImpossibleDeserialisationFailure"><span class="hs-identifier">ImpossibleDeserialisationFailure</span></a></a><span> </span><span class="hs-identifier hs-type">DeserialiseFailure</span><span>
</span><a name="line-86"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Language.PlutusTx.Plugin.html#ImpossibleDeserialisationFailure"><span class="hs-identifier hs-type">ImpossibleDeserialisationFailure</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-87"></a><span>    </span><a name="local-8214565720323790000"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusTx.Plugin.html#ImpossibleDeserialisationFailure"><span class="hs-identifier hs-var">ImpossibleDeserialisationFailure</span></a><span> </span><a name="local-6989586621679368531"><a href="#local-6989586621679368531"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Failed to deserialise our own program! This is a bug, please report it. Caused by: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679368531"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-88"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="Language.PlutusTx.Plugin.html#ImpossibleDeserialisationFailure"><span class="hs-identifier hs-type">ImpossibleDeserialisationFailure</span></a><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-identifier">getPlc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Plugin.html#CompiledCode"><span class="hs-identifier hs-type">CompiledCode</span></a><span> </span><a href="#local-6989586621679369786"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PLC.Program</span><span> </span><span class="hs-identifier hs-type">PLC.TyName</span><span> </span><span class="hs-identifier hs-type">PLC.Name</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><a name="getPlc"><a href="Language.PlutusTx.Plugin.html#getPlc"><span class="hs-identifier">getPlc</span></a></a><span> </span><a name="local-6989586621679369789"><a href="#local-6989586621679369789"><span class="hs-identifier">wrapper</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">deserialiseOrFail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Plugin.html#getSerializedPlc"><span class="hs-identifier hs-var">getSerializedPlc</span></a><span> </span><a href="#local-6989586621679369789"><span class="hs-identifier hs-var">wrapper</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679369790"><a href="#local-6989586621679369790"><span class="hs-identifier">e</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throw</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Plugin.html#ImpossibleDeserialisationFailure"><span class="hs-identifier hs-var">ImpossibleDeserialisationFailure</span></a><span> </span><a href="#local-6989586621679369790"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-93"></a><span>    </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679369791"><a href="#local-6989586621679369791"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679369791"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-identifier">getPir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Plugin.html#CompiledCode"><span class="hs-identifier hs-type">CompiledCode</span></a><span> </span><a href="#local-6989586621679369785"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PIR.Program</span><span> </span><span class="hs-identifier hs-type">PIR.TyName</span><span> </span><span class="hs-identifier hs-type">PIR.Name</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><a name="getPir"><a href="Language.PlutusTx.Plugin.html#getPir"><span class="hs-identifier">getPir</span></a></a><span> </span><a name="local-6989586621679369792"><a href="#local-6989586621679369792"><span class="hs-identifier">wrapper</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">deserialiseOrFail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Plugin.html#getSerializedPir"><span class="hs-identifier hs-var">getSerializedPir</span></a><span> </span><a href="#local-6989586621679369792"><span class="hs-identifier hs-var">wrapper</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679369793"><a href="#local-6989586621679369793"><span class="hs-identifier">e</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throw</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Plugin.html#ImpossibleDeserialisationFailure"><span class="hs-identifier hs-var">ImpossibleDeserialisationFailure</span></a><span> </span><a href="#local-6989586621679369793"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-98"></a><span>    </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679369794"><a href="#local-6989586621679369794"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679369794"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-comment">-- | Marks the given expression for conversion to PLC.</span><span>
</span><a name="line-101"></a><span class="hs-identifier">plc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679369783"><a href="#local-6989586621679369783"><span class="hs-identifier">loc</span></a></a><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679369784"><a href="#local-6989586621679369784"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679369784"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.Plugin.html#CompiledCode"><span class="hs-identifier hs-type">CompiledCode</span></a><span> </span><a href="#local-6989586621679369784"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-102"></a><span class="hs-comment">-- this constructor is only really there to get rid of the unused warning</span><span>
</span><a name="line-103"></a><a name="plc"><a href="Language.PlutusTx.Plugin.html#plc"><span class="hs-identifier">plc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Plugin.html#CompiledCode"><span class="hs-identifier hs-var">CompiledCode</span></a><span> </span><a href="Language.PlutusTx.Utils.html#mustBeReplaced"><span class="hs-identifier hs-var">mustBeReplaced</span></a><span> </span><a href="Language.PlutusTx.Utils.html#mustBeReplaced"><span class="hs-identifier hs-var">mustBeReplaced</span></a><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-keyword">data</span><span> </span><a name="PluginOptions"><a href="Language.PlutusTx.Plugin.html#PluginOptions"><span class="hs-identifier">PluginOptions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PluginOptions"><a href="Language.PlutusTx.Plugin.html#PluginOptions"><span class="hs-identifier">PluginOptions</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-106"></a><span>    </span><a name="poDoTypecheck"><a href="Language.PlutusTx.Plugin.html#poDoTypecheck"><span class="hs-identifier">poDoTypecheck</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="poDeferErrors"><a href="Language.PlutusTx.Plugin.html#poDeferErrors"><span class="hs-identifier">poDeferErrors</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="poStripContext"><a href="Language.PlutusTx.Plugin.html#poStripContext"><span class="hs-identifier">poStripContext</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-109"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-identifier">plugin</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">GHC.Plugin</span><span>
</span><a name="line-112"></a><a name="plugin"><a href="Language.PlutusTx.Plugin.html#plugin"><span class="hs-identifier">plugin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GHC.defaultPlugin</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">GHC.installCoreToDos</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Plugin.html#install"><span class="hs-identifier hs-var">install</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-identifier">install</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">GHC.CommandLineOption</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">GHC.CoreToDo</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">GHC.CoreToDo</span><span class="hs-special">]</span><span>
</span><a name="line-115"></a><a name="install"><a href="Language.PlutusTx.Plugin.html#install"><span class="hs-identifier">install</span></a></a><span> </span><a name="local-6989586621679369795"><a href="#local-6989586621679369795"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679369796"><a href="#local-6989586621679369796"><span class="hs-identifier">todo</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-117"></a><span>        </span><a name="local-6989586621679369797"><a href="#local-6989586621679369797"><span class="hs-identifier">opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Plugin.html#PluginOptions"><span class="hs-identifier hs-var">PluginOptions</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-118"></a><span>            </span><span class="hs-identifier">poDoTypecheck</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">notElem</span><span> </span><span class="hs-string">&quot;dont-typecheck&quot;</span><span> </span><a href="#local-6989586621679369795"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-119"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">poDeferErrors</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">elem</span><span> </span><span class="hs-string">&quot;defer-errors&quot;</span><span> </span><a href="#local-6989586621679369795"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-120"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">poStripContext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">elem</span><span> </span><span class="hs-string">&quot;strip-context&quot;</span><span> </span><a href="#local-6989586621679369795"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-121"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-123"></a><span>        </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.CoreDoPluginPass</span><span> </span><span class="hs-string">&quot;Core to PLC&quot;</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusTx.Plugin.html#pluginPass"><span class="hs-identifier hs-var">pluginPass</span></a><span> </span><a href="#local-6989586621679369797"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679369796"><span class="hs-identifier hs-var">todo</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-identifier">pluginPass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Plugin.html#PluginOptions"><span class="hs-identifier hs-type">PluginOptions</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.ModGuts</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><span class="hs-identifier hs-type">GHC.ModGuts</span><span>
</span><a name="line-126"></a><a name="pluginPass"><a href="Language.PlutusTx.Plugin.html#pluginPass"><span class="hs-identifier">pluginPass</span></a></a><span> </span><a name="local-6989586621679369798"><a href="#local-6989586621679369798"><span class="hs-identifier">opts</span></a></a><span> </span><a name="local-6989586621679369799"><a href="#local-6989586621679369799"><span class="hs-identifier">guts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Plugin.html#getMarkerName"><span class="hs-identifier hs-var">getMarkerName</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-127"></a><span>    </span><span class="hs-comment">-- nothing to do</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679369799"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-129"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679369800"><a href="#local-6989586621679369800"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">GHC.bindsOnlyPass</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Plugin.html#convertMarkedExprsBind"><span class="hs-identifier hs-var">convertMarkedExprsBind</span></a><span> </span><a href="#local-6989586621679369798"><span class="hs-identifier hs-var">opts</span></a><span> </span><a href="#local-6989586621679369800"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679369799"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-comment">{- Note [Hooking in the plugin]
Working out what to process and where to put it is tricky. We are going to turn the result in
to a 'CompiledCode', not the Haskell expression we started with!

Currently we look for calls to the 'plc :: a -&gt; CompiledCode' function, and we replace the whole application with the
generated code object, which will still be well-typed.

However, if we do this with a polymorphic expression as the argument to 'plc', we have problems
where GHC gives unconstrained type variables the type `Any` rather than leaving them abstracted as we require (see
note [System FC and system FW]). I don't currently know how to resolve this.
-}</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-identifier">getMarkerName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">GHC.Name</span><span class="hs-special">)</span><span>
</span><a name="line-144"></a><a name="getMarkerName"><a href="Language.PlutusTx.Plugin.html#getMarkerName"><span class="hs-identifier">getMarkerName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GHC.thNameToGhcName</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">plc</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-identifier">messagePrefix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-147"></a><a name="messagePrefix"><a href="Language.PlutusTx.Plugin.html#messagePrefix"><span class="hs-identifier">messagePrefix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;GHC Core to PLC plugin&quot;</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-identifier">failCompilation</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><a href="#local-6989586621679369726"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-150"></a><a name="failCompilation"><a href="Language.PlutusTx.Plugin.html#failCompilation"><span class="hs-identifier">failCompilation</span></a></a><span> </span><a name="local-6989586621679369801"><a href="#local-6989586621679369801"><span class="hs-identifier">message</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">GHC.throwGhcExceptionIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">GHC.ProgramError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Plugin.html#messagePrefix"><span class="hs-identifier hs-var">messagePrefix</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679369801"><span class="hs-identifier hs-var">message</span></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-identifier">failCompilationSDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><a href="#local-6989586621679369725"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-153"></a><a name="failCompilationSDoc"><a href="Language.PlutusTx.Plugin.html#failCompilationSDoc"><span class="hs-identifier">failCompilationSDoc</span></a></a><span> </span><a name="local-6989586621679369825"><a href="#local-6989586621679369825"><span class="hs-identifier">message</span></a></a><span> </span><a name="local-6989586621679369826"><a href="#local-6989586621679369826"><span class="hs-identifier">sdoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">GHC.throwGhcExceptionIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">GHC.PprProgramError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusTx.Plugin.html#messagePrefix"><span class="hs-identifier hs-var">messagePrefix</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679369825"><span class="hs-identifier hs-var">message</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679369826"><span class="hs-identifier hs-var">sdoc</span></a><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-comment">-- | Get the 'GHC.Name' corresponding to the given 'TH.Name', or throw a GHC exception if</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- we can't get it.</span><span>
</span><a name="line-157"></a><span class="hs-identifier">thNameToGhcNameOrFail</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TH.Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><span class="hs-identifier hs-type">GHC.Name</span><span>
</span><a name="line-158"></a><a name="thNameToGhcNameOrFail"><a href="Language.PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier">thNameToGhcNameOrFail</span></a></a><span> </span><a name="local-6989586621679369827"><a href="#local-6989586621679369827"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-159"></a><span>    </span><a name="local-6989586621679369828"><a href="#local-6989586621679369828"><span class="hs-identifier">maybeName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.thNameToGhcName</span><span> </span><a href="#local-6989586621679369827"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-160"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679369828"><span class="hs-identifier hs-var">maybeName</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-161"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679369829"><a href="#local-6989586621679369829"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679369829"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-162"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.Plugin.html#failCompilation"><span class="hs-identifier hs-var">failCompilation</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Unable to get Core name needed for the plugin to function: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679369827"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- | Create a GHC Core expression that will evaluate to the given ByteString at runtime.</span><span>
</span><a name="line-165"></a><span class="hs-identifier">makeByteStringLiteral</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BS.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><span class="hs-identifier hs-type">GHC.CoreExpr</span><span>
</span><a name="line-166"></a><a name="makeByteStringLiteral"><a href="Language.PlutusTx.Plugin.html#makeByteStringLiteral"><span class="hs-identifier">makeByteStringLiteral</span></a></a><span> </span><a name="local-6989586621679369830"><a href="#local-6989586621679369830"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-167"></a><span>    </span><a name="local-6989586621679369831"><a href="#local-6989586621679369831"><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.getDynFlags</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>    </span><span class="hs-comment">{-
    This entire section will crash horribly in a number of circumstances. Such is life.
    - If any of the names we need can't be found as GHC Names
    - If we then can't look up those GHC Names to get their IDs/types
    - If we make any mistakes creating the Core expression
    -}</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span>    </span><span class="hs-comment">-- Get the names of functions/types that we need for our expression</span><span>
</span><a name="line-177"></a><span>    </span><a name="local-6989586621679369851"><a href="#local-6989586621679369851"><span class="hs-identifier">upio</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.lookupId</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Language.PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">unsafePerformIO</span><span>
</span><a name="line-178"></a><span>    </span><a name="local-6989586621679369852"><a href="#local-6989586621679369852"><span class="hs-identifier">bsTc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.lookupTyCon</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Language.PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">BS.ByteString</span><span>
</span><a name="line-179"></a><span>    </span><a name="local-6989586621679369853"><a href="#local-6989586621679369853"><span class="hs-identifier">upal</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.lookupId</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Language.PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">BSUnsafe.unsafePackAddressLen</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span>    </span><span class="hs-comment">-- We construct the following expression:</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-comment">-- unsafePerformIO $ unsafePackAddressLen &lt;length as int literal&gt; &lt;data as string literal address&gt;</span><span>
</span><a name="line-183"></a><span>    </span><span class="hs-comment">-- This technique gratefully borrowed from the file-embed package</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>    </span><span class="hs-comment">-- The flags here are so GHC can check whether the int is in range for the current platform.</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679369854"><a href="#local-6989586621679369854"><span class="hs-identifier">lenLit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GHC.mkIntExpr</span><span> </span><a href="#local-6989586621679369831"><span class="hs-identifier hs-var">flags</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679369830"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-187"></a><span>    </span><span class="hs-comment">-- This will have type Addr#, which is right for unsafePackAddressLen</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679369855"><a href="#local-6989586621679369855"><span class="hs-identifier">bsLit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GHC.Lit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.MachStr</span><span> </span><a href="#local-6989586621679369830"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679369856"><a href="#local-6989586621679369856"><span class="hs-identifier">upaled</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GHC.mkCoreApps</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.Var</span><span> </span><a href="#local-6989586621679369853"><span class="hs-identifier hs-var">upal</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679369854"><span class="hs-identifier hs-var">lenLit</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679369855"><span class="hs-identifier hs-var">bsLit</span></a><span class="hs-special">]</span><span>
</span><a name="line-190"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679369857"><a href="#local-6989586621679369857"><span class="hs-identifier">upioed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GHC.mkCoreApps</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.Var</span><span> </span><a href="#local-6989586621679369851"><span class="hs-identifier hs-var">upio</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">GHC.Type</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.mkTyConTy</span><span> </span><a href="#local-6989586621679369852"><span class="hs-identifier hs-var">bsTc</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679369856"><span class="hs-identifier hs-var">upaled</span></a><span class="hs-special">]</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679369857"><span class="hs-identifier hs-var">upioed</span></a><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-comment">-- | Make a 'BuiltinNameInfo' mapping the given set of TH names to their</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- 'GHC.TyThing's for later reference.</span><span>
</span><a name="line-196"></a><span class="hs-identifier">makePrimitiveNameInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TH.Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#BuiltinNameInfo"><span class="hs-identifier hs-type">BuiltinNameInfo</span></a><span>
</span><a name="line-197"></a><a name="makePrimitiveNameInfo"><a href="Language.PlutusTx.Plugin.html#makePrimitiveNameInfo"><span class="hs-identifier">makePrimitiveNameInfo</span></a></a><span> </span><a name="local-6989586621679369858"><a href="#local-6989586621679369858"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-198"></a><span>    </span><a name="local-6989586621679369862"><a href="#local-6989586621679369862"><span class="hs-identifier">mapped</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forM</span><span> </span><a href="#local-6989586621679369858"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679369859"><a href="#local-6989586621679369859"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-199"></a><span>        </span><a name="local-6989586621679369860"><a href="#local-6989586621679369860"><span class="hs-identifier">ghcName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a><span> </span><a href="#local-6989586621679369859"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-200"></a><span>        </span><a name="local-6989586621679369861"><a href="#local-6989586621679369861"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.lookupThing</span><span> </span><a href="#local-6989586621679369860"><span class="hs-identifier hs-var">ghcName</span></a><span>
</span><a name="line-201"></a><span>        </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679369859"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679369861"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><a href="#local-6989586621679369862"><span class="hs-identifier hs-var">mapped</span></a><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-comment">-- | Converts all the marked expressions in the given binder into PLC literals.</span><span>
</span><a name="line-205"></a><span class="hs-identifier">convertMarkedExprsBind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Plugin.html#PluginOptions"><span class="hs-identifier hs-type">PluginOptions</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreBind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><span class="hs-identifier hs-type">GHC.CoreBind</span><span>
</span><a name="line-206"></a><a name="convertMarkedExprsBind"><a href="Language.PlutusTx.Plugin.html#convertMarkedExprsBind"><span class="hs-identifier">convertMarkedExprsBind</span></a></a><span> </span><a name="local-6989586621679369863"><a href="#local-6989586621679369863"><span class="hs-identifier">opts</span></a></a><span> </span><a name="local-6989586621679369864"><a href="#local-6989586621679369864"><span class="hs-identifier">markerName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-207"></a><span>    </span><span class="hs-identifier hs-var">GHC.NonRec</span><span> </span><a name="local-6989586621679369865"><a href="#local-6989586621679369865"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679369866"><a href="#local-6989586621679369866"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">GHC.NonRec</span><span> </span><a href="#local-6989586621679369865"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Plugin.html#convertMarkedExprs"><span class="hs-identifier hs-var">convertMarkedExprs</span></a><span> </span><a href="#local-6989586621679369863"><span class="hs-identifier hs-var">opts</span></a><span> </span><a href="#local-6989586621679369864"><span class="hs-identifier hs-var">markerName</span></a><span> </span><a href="#local-6989586621679369866"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-208"></a><span>    </span><span class="hs-identifier hs-var">GHC.Rec</span><span> </span><a name="local-6989586621679369867"><a href="#local-6989586621679369867"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">GHC.Rec</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679369868"><a href="#local-6989586621679369868"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679369869"><a href="#local-6989586621679369869"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679369868"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusTx.Plugin.html#convertMarkedExprs"><span class="hs-identifier hs-var">convertMarkedExprs</span></a><span> </span><a href="#local-6989586621679369863"><span class="hs-identifier hs-var">opts</span></a><span> </span><a href="#local-6989586621679369864"><span class="hs-identifier hs-var">markerName</span></a><span> </span><a href="#local-6989586621679369869"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679369867"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span class="hs-comment">-- | Converts all the marked expressions in the given expression into PLC literals.</span><span>
</span><a name="line-211"></a><span class="hs-identifier">convertMarkedExprs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Plugin.html#PluginOptions"><span class="hs-identifier hs-type">PluginOptions</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><span class="hs-identifier hs-type">GHC.CoreExpr</span><span>
</span><a name="line-212"></a><a name="convertMarkedExprs"><a href="Language.PlutusTx.Plugin.html#convertMarkedExprs"><span class="hs-identifier">convertMarkedExprs</span></a></a><span> </span><a name="local-6989586621679369870"><a href="#local-6989586621679369870"><span class="hs-identifier">opts</span></a></a><span> </span><a name="local-6989586621679369871"><a href="#local-6989586621679369871"><span class="hs-identifier">markerName</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-214"></a><span>        </span><a name="local-6989586621679369872"><a href="#local-6989586621679369872"><span class="hs-identifier">conv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Plugin.html#convertMarkedExprs"><span class="hs-identifier hs-var">convertMarkedExprs</span></a><span> </span><a href="#local-6989586621679369870"><span class="hs-identifier hs-var">opts</span></a><span> </span><a href="#local-6989586621679369871"><span class="hs-identifier hs-var">markerName</span></a><span>
</span><a name="line-215"></a><span>        </span><a name="local-6989586621679369873"><a href="#local-6989586621679369873"><span class="hs-identifier">convB</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Plugin.html#convertMarkedExprsBind"><span class="hs-identifier hs-var">convertMarkedExprsBind</span></a><span> </span><a href="#local-6989586621679369870"><span class="hs-identifier hs-var">opts</span></a><span> </span><a href="#local-6989586621679369871"><span class="hs-identifier hs-var">markerName</span></a><span>
</span><a name="line-216"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-217"></a><span>      </span><span class="hs-identifier hs-var">GHC.App</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.App</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.App</span><span>
</span><a name="line-218"></a><span>                          </span><span class="hs-comment">-- function id</span><span>
</span><a name="line-219"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.Var</span><span> </span><a name="local-6989586621679369874"><a href="#local-6989586621679369874"><span class="hs-identifier">fid</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-220"></a><span>                          </span><span class="hs-comment">-- first type argument, must be a string literal type</span><span>
</span><a name="line-221"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.Type</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.isStrLitTy</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679369875"><a href="#local-6989586621679369875"><span class="hs-identifier">fs_locStr</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>                     </span><span class="hs-comment">-- second type argument</span><span>
</span><a name="line-223"></a><span>                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.Type</span><span> </span><a name="local-6989586621679369876"><a href="#local-6989586621679369876"><span class="hs-identifier">codeTy</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>            </span><span class="hs-comment">-- value argument</span><span>
</span><a name="line-225"></a><span>            </span><a name="local-6989586621679369877"><a href="#local-6989586621679369877"><span class="hs-identifier">inner</span></a></a><span>
</span><a name="line-226"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679369871"><span class="hs-identifier hs-var">markerName</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">GHC.idName</span><span> </span><a href="#local-6989586621679369874"><span class="hs-identifier hs-var">fid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.Plugin.html#convertExpr"><span class="hs-identifier hs-var">convertExpr</span></a><span> </span><a href="#local-6989586621679369870"><span class="hs-identifier hs-var">opts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679369875"><span class="hs-identifier hs-var">fs_locStr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679369876"><span class="hs-identifier hs-var">codeTy</span></a><span> </span><a href="#local-6989586621679369877"><span class="hs-identifier hs-var">inner</span></a><span>
</span><a name="line-227"></a><span>      </span><a name="local-6989586621679370023"><a href="#local-6989586621679370023"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.Var</span><span> </span><a name="local-6989586621679370024"><a href="#local-6989586621679370024"><span class="hs-identifier">fid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679369871"><span class="hs-identifier hs-var">markerName</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">GHC.idName</span><span> </span><a href="#local-6989586621679370024"><span class="hs-identifier hs-var">fid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusTx.Plugin.html#failCompilationSDoc"><span class="hs-identifier hs-var">failCompilationSDoc</span></a><span> </span><span class="hs-string">&quot;Found invalid marker, not applied correctly&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.ppr</span><span> </span><a href="#local-6989586621679370023"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>      </span><span class="hs-identifier hs-var">GHC.App</span><span> </span><a name="local-6989586621679370025"><a href="#local-6989586621679370025"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679370026"><a href="#local-6989586621679370026"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">GHC.App</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679369872"><span class="hs-identifier hs-var">conv</span></a><span> </span><a href="#local-6989586621679370025"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679369872"><span class="hs-identifier hs-var">conv</span></a><span> </span><a href="#local-6989586621679370026"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-229"></a><span>      </span><span class="hs-identifier hs-var">GHC.Lam</span><span> </span><a name="local-6989586621679370027"><a href="#local-6989586621679370027"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679370028"><a href="#local-6989586621679370028"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">GHC.Lam</span><span> </span><a href="#local-6989586621679370027"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679369872"><span class="hs-identifier hs-var">conv</span></a><span> </span><a href="#local-6989586621679370028"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-230"></a><span>      </span><span class="hs-identifier hs-var">GHC.Let</span><span> </span><a name="local-6989586621679370029"><a href="#local-6989586621679370029"><span class="hs-identifier">bnd</span></a></a><span> </span><a name="local-6989586621679370030"><a href="#local-6989586621679370030"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">GHC.Let</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679369873"><span class="hs-identifier hs-var">convB</span></a><span> </span><a href="#local-6989586621679370029"><span class="hs-identifier hs-var">bnd</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679369872"><span class="hs-identifier hs-var">conv</span></a><span> </span><a href="#local-6989586621679370030"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-231"></a><span>      </span><span class="hs-identifier hs-var">GHC.Case</span><span> </span><a name="local-6989586621679370031"><a href="#local-6989586621679370031"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679370032"><a href="#local-6989586621679370032"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679370033"><a href="#local-6989586621679370033"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679370034"><a href="#local-6989586621679370034"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-232"></a><span>            </span><a name="local-6989586621679370035"><a href="#local-6989586621679370035"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679369872"><span class="hs-identifier hs-var">conv</span></a><span> </span><a href="#local-6989586621679370031"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-233"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679370036"><a href="#local-6989586621679370036"><span class="hs-identifier">expAlt</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679370037"><a href="#local-6989586621679370037"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679370038"><a href="#local-6989586621679370038"><span class="hs-identifier">bs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679370039"><a href="#local-6989586621679370039"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679370037"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679370038"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679369872"><span class="hs-identifier hs-var">conv</span></a><span> </span><a href="#local-6989586621679370039"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-234"></a><span>            </span><a name="local-6989586621679370040"><a href="#local-6989586621679370040"><span class="hs-identifier">alts'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679370036"><span class="hs-identifier hs-var">expAlt</span></a><span> </span><a href="#local-6989586621679370034"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-235"></a><span>            </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">GHC.Case</span><span> </span><a href="#local-6989586621679370035"><span class="hs-identifier hs-var">e'</span></a><span> </span><a href="#local-6989586621679370032"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679370033"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679370040"><span class="hs-identifier hs-var">alts'</span></a><span>
</span><a name="line-236"></a><span>      </span><span class="hs-identifier hs-var">GHC.Cast</span><span> </span><a name="local-6989586621679370041"><a href="#local-6989586621679370041"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679370042"><a href="#local-6989586621679370042"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">GHC.Cast</span><span> </span><a href="#local-6989586621679370042"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679369872"><span class="hs-identifier hs-var">conv</span></a><span> </span><a href="#local-6989586621679370041"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-237"></a><span>      </span><span class="hs-identifier hs-var">GHC.Tick</span><span> </span><a name="local-6989586621679370043"><a href="#local-6989586621679370043"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679370044"><a href="#local-6989586621679370044"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">GHC.Tick</span><span> </span><a href="#local-6989586621679370043"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679369872"><span class="hs-identifier hs-var">conv</span></a><span> </span><a href="#local-6989586621679370044"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-238"></a><span>      </span><a name="local-6989586621679370045"><a href="#local-6989586621679370045"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.Coercion</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679370045"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-239"></a><span>      </span><a name="local-6989586621679370046"><a href="#local-6989586621679370046"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.Lit</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679370046"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-240"></a><span>      </span><a name="local-6989586621679370047"><a href="#local-6989586621679370047"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.Var</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679370047"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-241"></a><span>      </span><a name="local-6989586621679370048"><a href="#local-6989586621679370048"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.Type</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679370048"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-comment">-- TODO: move this somewhere common</span><span>
</span><a name="line-244"></a><span class="hs-identifier">stringBuiltinTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PLC.DynamicBuiltinNameTypes</span><span>
</span><a name="line-245"></a><a name="stringBuiltinTypes"><a href="Language.PlutusTx.Plugin.html#stringBuiltinTypes"><span class="hs-identifier">stringBuiltinTypes</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-246"></a><span>    </span><span class="hs-comment">-- In order to define @trace@ we have to provide a function that actually performs tracing,</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-comment">-- but this can't be done once and for all, because we do tracing via 'unsafePerformIO' and 'IORef'</span><span>
</span><a name="line-248"></a><span>    </span><span class="hs-comment">-- and thus need to either be in the 'IO' monad to create an 'IORef' or create a global 'IORef' via</span><span>
</span><a name="line-249"></a><span>    </span><span class="hs-comment">-- another 'unsafePerformIO' (perhaps we should do the latter).</span><span>
</span><a name="line-250"></a><span>    </span><span class="hs-comment">-- Anyway, here we only care about types, so we provide a fake definition of @trace@ that does</span><span>
</span><a name="line-251"></a><span>    </span><span class="hs-comment">-- nothing just to be able to extract types in a convenient way.</span><span>
</span><a name="line-252"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679370049"><a href="#local-6989586621679370049"><span class="hs-identifier">fakeTraceDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PLC.dynamicCallAssign</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PLC.TypedBuiltinDyn</span><span> </span><span class="hs-glyph">@</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">PLC.dynamicTraceName</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-253"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">PLC.dynamicBuiltinNameMeaningsToTypes</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-254"></a><span>       </span><span class="hs-identifier hs-var">PLC.insertDynamicBuiltinNameDefinition</span><span> </span><a href="#local-6989586621679370049"><span class="hs-identifier hs-var">fakeTraceDefinition</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-255"></a><span>       </span><span class="hs-identifier hs-var">PLC.insertDynamicBuiltinNameDefinition</span><span> </span><span class="hs-identifier hs-var">PLC.dynamicCharToStringDefinition</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-256"></a><span>       </span><span class="hs-identifier hs-var">PLC.insertDynamicBuiltinNameDefinition</span><span> </span><span class="hs-identifier hs-var">PLC.dynamicAppendDefinition</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span class="hs-comment">-- | Actually invokes the Core to PLC compiler to convert an expression into a PLC literal.</span><span>
</span><a name="line-259"></a><span class="hs-identifier">convertExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusTx.Plugin.html#PluginOptions"><span class="hs-identifier hs-type">PluginOptions</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GHC.CoreM</span><span> </span><span class="hs-identifier hs-type">GHC.CoreExpr</span><span>
</span><a name="line-260"></a><a name="convertExpr"><a href="Language.PlutusTx.Plugin.html#convertExpr"><span class="hs-identifier">convertExpr</span></a></a><span> </span><a name="local-6989586621679370148"><a href="#local-6989586621679370148"><span class="hs-identifier">opts</span></a></a><span> </span><a name="local-6989586621679370149"><a href="#local-6989586621679370149"><span class="hs-identifier">locStr</span></a></a><span> </span><a name="local-6989586621679370150"><a href="#local-6989586621679370150"><span class="hs-identifier">codeTy</span></a></a><span> </span><a name="local-6989586621679370151"><a href="#local-6989586621679370151"><span class="hs-identifier">origE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-261"></a><span>    </span><a name="local-6989586621679370152"><a href="#local-6989586621679370152"><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.getDynFlags</span><span>
</span><a name="line-262"></a><span>    </span><span class="hs-comment">-- We need to do this out here, since it has to run in CoreM</span><span>
</span><a name="line-263"></a><span>    </span><a name="local-6989586621679370153"><a href="#local-6989586621679370153"><span class="hs-identifier">nameInfo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Plugin.html#makePrimitiveNameInfo"><span class="hs-identifier hs-var">makePrimitiveNameInfo</span></a><span> </span><a href="Language.PlutusTx.Compiler.Builtins.html#builtinNames"><span class="hs-identifier hs-var">builtinNames</span></a><span>
</span><a name="line-264"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679370154"><a href="#local-6989586621679370154"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Compiler.Error.html#withContextM"><span class="hs-identifier hs-var">withContextM</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusTx.Compiler.Utils.html#sdToTxt"><span class="hs-identifier hs-var">sdToTxt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Converting expr at&quot;</span><span> </span><span class="hs-operator hs-var">GHC.&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">GHC.text</span><span> </span><a href="#local-6989586621679370149"><span class="hs-identifier hs-var">locStr</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-265"></a><span>              </span><span class="hs-special">(</span><a name="local-6989586621679370156"><a href="#local-6989586621679370156"><span class="hs-identifier">pirP</span></a></a><span class="hs-glyph">::</span><a href="Language.PlutusTx.PIRTypes.html#PIRProgram"><span class="hs-identifier hs-type">PIRProgram</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">PIR.Program</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">PIR.removeDeadBindings</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PIR.runDefT</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusTx.Compiler.Expr.html#convExprWithDefs"><span class="hs-identifier hs-var">convExprWithDefs</span></a><span> </span><a href="#local-6989586621679370151"><span class="hs-identifier hs-var">origE</span></a><span class="hs-special">)</span><span>
</span><a name="line-266"></a><span>              </span><span class="hs-special">(</span><a name="local-6989586621679370157"><a href="#local-6989586621679370157"><span class="hs-identifier">plcP</span></a></a><span class="hs-glyph">::</span><a href="Language.PlutusTx.PLCTypes.html#PLCProgram"><span class="hs-identifier hs-type">PLCProgram</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier">runReaderT</span><span> </span><span class="hs-identifier hs-var">PIR.NoProvenance</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PIR.compileProgram</span><span> </span><a href="#local-6989586621679370156"><span class="hs-identifier hs-var">pirP</span></a><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>              </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">poDoTypecheck</span><span> </span><a href="#local-6989586621679370148"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-268"></a><span>                  </span><span class="hs-identifier hs-var">PLC.typecheckProgram</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PLC.TypeConfig</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="Language.PlutusTx.Plugin.html#stringBuiltinTypes"><span class="hs-identifier hs-var">stringBuiltinTypes</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679370157"><span class="hs-identifier hs-var">plcP</span></a><span>
</span><a name="line-269"></a><span>              </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679370156"><span class="hs-identifier hs-var">pirP</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679370157"><span class="hs-identifier hs-var">plcP</span></a><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>        </span><a name="local-6989586621679370155"><a href="#local-6989586621679370155"><span class="hs-identifier">context</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusTx.Compiler.Types.html#ConvertingContext"><span class="hs-identifier hs-var">ConvertingContext</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-271"></a><span>            </span><span class="hs-identifier">ccOpts</span><span class="hs-glyph">=</span><a href="Language.PlutusTx.Compiler.Types.html#ConversionOptions"><span class="hs-identifier hs-var">ConversionOptions</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">coCheckValueRestriction</span><span class="hs-glyph">=</span><span class="hs-identifier">poDoTypecheck</span><span> </span><a href="#local-6989586621679370148"><span class="hs-identifier hs-var">opts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-272"></a><span>            </span><span class="hs-identifier">ccFlags</span><span class="hs-glyph">=</span><a href="#local-6989586621679370152"><span class="hs-identifier hs-var">flags</span></a><span class="hs-special">,</span><span>
</span><a name="line-273"></a><span>            </span><span class="hs-identifier">ccBuiltinNameInfo</span><span class="hs-glyph">=</span><a href="#local-6989586621679370153"><span class="hs-identifier hs-var">nameInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-274"></a><span>            </span><span class="hs-identifier">ccScopes</span><span class="hs-glyph">=</span><a href="Language.PlutusTx.Compiler.Types.html#initialScopeStack"><span class="hs-identifier hs-var">initialScopeStack</span></a><span>
</span><a name="line-275"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-276"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">runExcept</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">runQuoteT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier">runReaderT</span><span> </span><a href="#local-6989586621679370155"><span class="hs-identifier hs-var">context</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679370154"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-277"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679370158"><a href="#local-6989586621679370158"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-278"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679370159"><a href="#local-6989586621679370159"><span class="hs-identifier">shown</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">poStripContext</span><span> </span><a href="#local-6989586621679370148"><span class="hs-identifier hs-var">opts</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">PP.pretty</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusTx.Compiler.Error.html#stripContext"><span class="hs-identifier hs-var">stripContext</span></a><span> </span><a href="#local-6989586621679370158"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">PP.pretty</span><span> </span><a href="#local-6989586621679370158"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-279"></a><span>            </span><span class="hs-comment">-- TODO: is this the right way to do either of these things?</span><span>
</span><a name="line-280"></a><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">poDeferErrors</span><span> </span><a href="#local-6989586621679370148"><span class="hs-identifier hs-var">opts</span></a><span>
</span><a name="line-281"></a><span>            </span><span class="hs-comment">-- this will blow up at runtime</span><span>
</span><a name="line-282"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-283"></a><span>                </span><a name="local-6989586621679370160"><a href="#local-6989586621679370160"><span class="hs-identifier">tcName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">CompiledCode</span><span>
</span><a name="line-284"></a><span>                </span><a name="local-6989586621679370161"><a href="#local-6989586621679370161"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.lookupTyCon</span><span> </span><a href="#local-6989586621679370160"><span class="hs-identifier hs-var">tcName</span></a><span>
</span><a name="line-285"></a><span>                </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">GHC.mkRuntimeErrorApp</span><span> </span><span class="hs-identifier hs-var">GHC.rUNTIME_ERROR_ID</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.mkTyConApp</span><span> </span><a href="#local-6989586621679370161"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679370150"><span class="hs-identifier hs-var">codeTy</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679370159"><span class="hs-identifier hs-var">shown</span></a><span>
</span><a name="line-286"></a><span>            </span><span class="hs-comment">-- this will actually terminate compilation</span><span>
</span><a name="line-287"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="Language.PlutusTx.Plugin.html#failCompilation"><span class="hs-identifier hs-var">failCompilation</span></a><span> </span><a href="#local-6989586621679370159"><span class="hs-identifier hs-var">shown</span></a><span>
</span><a name="line-288"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679370162"><a href="#local-6989586621679370162"><span class="hs-identifier">pirP</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679370163"><a href="#local-6989586621679370163"><span class="hs-identifier">plcP</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-289"></a><span>            </span><a name="local-6989586621679370164"><a href="#local-6989586621679370164"><span class="hs-identifier">bsLitPir</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Plugin.html#makeByteStringLiteral"><span class="hs-identifier hs-var">makeByteStringLiteral</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BSL.toStrict</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">serialise</span><span> </span><a href="#local-6989586621679370162"><span class="hs-identifier hs-var">pirP</span></a><span>
</span><a name="line-290"></a><span>            </span><a name="local-6989586621679370165"><a href="#local-6989586621679370165"><span class="hs-identifier">bsLitPlc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Plugin.html#makeByteStringLiteral"><span class="hs-identifier hs-var">makeByteStringLiteral</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BSL.toStrict</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">serialise</span><span> </span><a href="#local-6989586621679370163"><span class="hs-identifier hs-var">plcP</span></a><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span>            </span><a name="local-6989586621679370166"><a href="#local-6989586621679370166"><span class="hs-identifier">dcName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">CompiledCode</span><span>
</span><a name="line-293"></a><span>            </span><a name="local-6989586621679370167"><a href="#local-6989586621679370167"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">GHC.lookupDataCon</span><span> </span><a href="#local-6989586621679370166"><span class="hs-identifier hs-var">dcName</span></a><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span>            </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-296"></a><span>                </span><span class="hs-identifier hs-var">GHC.Var</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.dataConWrapId</span><span> </span><a href="#local-6989586621679370167"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>                </span><span class="hs-special">`</span><span class="hs-identifier hs-var">GHC.App</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">GHC.Type</span><span> </span><a href="#local-6989586621679370150"><span class="hs-identifier hs-var">codeTy</span></a><span>
</span><a name="line-298"></a><span>                </span><span class="hs-special">`</span><span class="hs-identifier hs-var">GHC.App</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679370165"><span class="hs-identifier hs-var">bsLitPlc</span></a><span>
</span><a name="line-299"></a><span>                </span><span class="hs-special">`</span><span class="hs-identifier hs-var">GHC.App</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679370164"><span class="hs-identifier hs-var">bsLitPir</span></a><span>
</span><a name="line-300"></a></pre></body></html>